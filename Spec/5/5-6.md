### 5.6 感情ラベルの抽選

本節では、イベント発生時における感情ラベルの変化抽選仕様について記述する。抽選結果により、キャラクターAからBへの感情ラベル（例：「気になる」「嫌いかも」など）が変化する可能性がある。

#### 5.6.1 抽選対象

A→B 間でイベントが発生した場合、その直後に感情ラベルの変化抽選が実施される。

なお、**「気になる」「嫌いかも」は減衰対象とする**。抽選によって他のラベルに遷移する可能性を残しつつ、自然変化も併用する。

#### 5.6.2 抽選処理の概要

1. 現在の感情ラベル、関係ラベルをもとに候補ラベルを取得
2. `5.5` で決定された雰囲気（mood）を取得し、候補ごとの重みを補正
3. 補正後の重みをもとに、確率的に1ラベルを抽選
4. 抽選結果が現在のラベルと異なる場合、ラベルを変更

### 5.6.3 重みテーブル構造

感情ラベル抽選に用いる重みテーブル（`emotion_label_draw.json`）は、以下のような構造を持つ：

```json
{
  "normal_relationship": {
    "通常_気になる": {
      "とてもポジティブ": {
        "変化なし": 0.6,
        "なし": 0.0,
        "好きかも": 0.35,
        "気まずい": 0.05
      },
      ...
    },
    ...
  },
  "special_relationship": {
    "特殊_好き": {
      "とてもポジティブ": {
        "変化なし": 0.7,
        "普通": 0.0,
        "大好き": 0.3,
        "気まずい": 0.0
      },
      ...
    },
    ...
  }
}
```

* `normal_relationship` は関係ラベルが「通常」（友達・知人など）の場合に使用される。
* `special_relationship` は関係ラベルが「特殊」（恋人・親友・家族）の場合に使用される。
* `"通常_気になる"` や `"特殊_好き"` は現在の感情ラベルに対応するエントリ。
* その下にある `"とてもポジティブ"` などは雰囲気に対応しており、抽選対象となるラベルごとの重み（確率）を定義している。
* 重みの合計は必ずしも 1.0 である必要はなく、相対比で扱われる。
* `"変化なし"` というキーが含まれており、抽選の結果、ラベルが変化しない場合もある。

### 5.6.4 雰囲気による補正の例（修正版）

例：関係ラベルが通常で、現在の感情ラベルが「気になる」、雰囲気が「とてもネガティブ」の場合：

```json
{
  "変化なし": 0.5,
  "なし": 0.3,
  "好きかも": 0.0,
  "気まずい": 0.2
}
```

→ 前向きな変化（「好きかも」）の重みは 0.0 とされており、実質的に抽選対象外となる。

一方、雰囲気が「とてもポジティブ」の場合：

```json
{
  "変化なし": 0.6,
  "なし": 0.0,
  "好きかも": 0.35,
  "気まずい": 0.05
}
```

→ 上昇方向（「好きかも」）の変化が強く反映される。

※「変化なし」は現在のラベルの継続を意味し、それ自体も確率の一要素として扱われる。

#### 5.6.5 実装備考

* 雰囲気に基づく重み補正は事前に定義されたテーブルに従う
* 抽選後にラベルが変化した場合は、ログ出力およびステータスに反映される