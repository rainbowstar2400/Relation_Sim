### 6.7 テンプレート構造と保存仕様

本節では、相談イベント等で使用されるテンプレートデータの構造、および保存・抽出に関する仕様を定義する。テンプレートはキャラクターごとのデータとは独立しており、共通のイベント資源として全キャラクターで共有される。

#### 6.7.1 テンプレートデータの構成概要

テンプレートは「困りごと相談イベント」の表示内容を構成する文章群であり、以下の特徴を持つ：

* キャラクター個別ではなく、全体の共通データとして保持される
* 各テンプレートは、ジャンル・深さレベル・形式といった分類情報を持つ
* 出力時には信頼度や性格パラメータに応じて、抽選・フィルタを経て選出される（→5.3.3、5.4）

保存形式はJSONで統一され、各テンプレートは一意のIDを持つ。テンプレート一覧はファイル単位で分割されていてもよく、読み込み時に結合される。

#### 6.7.2 テンプレート項目の定義

テンプレートオブジェクトは、以下の要素を持つ：

| 項目名           | 型      | 説明                        |
| ------------- | ------ | ------------------------- |
| `id`          | string | テンプレートID。ファイル内一意。例："A012" |
| `genre`       | string | テンプレートのジャンル分類（A〜E）        |
| `level`       | int    | 深さレベル（0〜3）                |
| `form`        | string | 形式：`"choice"`または`"fill"`  |
| `core_prompt` | string | 出力用セリフの本文（プレーンテキスト）       |

ジャンルやレベルの意味付け、使用範囲の制限については「5.3.3」にて詳述されている。

#### 6.7.3 JSON構造例と解説

以下に、テンプレートデータの例を示す：

```json
{
  "id": "B027",
  "genre": "B",
  "level": 1,
  "form": "fill",
  "core_prompt": "今日はちょっとだけサボっちゃった。こういう日ってあるよね？"
}
```

このデータは以下のように解釈される：

* ジャンルB（例：日常／悩み）のテンプレート
* 信頼度が中程度（目安：40以上）で出現可能なLv1
* プレイヤーが空欄を埋めるタイプの穴埋め式
* 出力時にはこの本文が `core_prompt` としてそのまま渡される（→5.4）

#### 6.7.4 保存・取得に関する補足

* テンプレートは複数ファイルに分割しても構わず、読み込み時に統合管理される
* 出力時には、信頼度・キャラ性格・テンプレレベルなどをもとに**条件抽出 + 重み抽選**が行われる（→5.3.3.2）
* 将来的に `tone_tag` などをテンプレ側に記述する可能性もあるが、現時点ではテンプレート側では保持しない
* 抽選後に補助データ（tone\_tag等）を付加して `core_prompt` と一緒に出力構造を構成する（→5.4）