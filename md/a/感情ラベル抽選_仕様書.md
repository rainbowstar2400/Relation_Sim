
# 🎲 感情ラベル変化 抽選仕様書

---

## 🎯 目的

キャラクター同士の会話イベントなどが発生した際、一定確率で感情ラベルが変化する。  
この抽選処理を統一仕様として定義し、イベント種・関係ラベル・好感度などに応じた確率で実行される。

---

## 🔧 対象となるイベント種

- 雑談イベント
- 思い出し会話イベント
- 二人きりの時間イベント
- 初対面イベント

---

## 🎯 基本方針

- **感情ラベル変化の抽選確率は約30%（70%は変化なし）**
- 変化内容は、イベント種 × 現在の感情ラベル × 関係ラベル × 好感度 によって確率分布を持つ
- **好感度は内部的に0～100の整数値とし、数値によって変化方向（正 or 負）の分布が異なる**
- 抽選は**イベント内容には依存せず**、イベント種と状態のみで決定する
- 抽選結果として得られた感情ラベルは、即座に反映され、UIやログに表示される

---

## 🧩 感情ラベル遷移モデル（通常時）

### ● 初期状態：「なし」  
- → 「気になる」：発生イベントがポジティブ、好感度高め（例：雑談）
- → 「嫌いかも」：発生イベントがネガティブ、好感度低め（例：気まずい）

### ● 「気になる」状態  
- → 「好きかも」：繰り返し接触や高好感度
- → 「なし」（リセット）：一定期間イベント未発生
- → 「嫌いかも」：対立的イベントが発生した場合

### ● 「好きかも」「嫌いかも」状態  
- 基本的に**自然リセットはしない**。  
- 別イベントによる変化でのみ遷移

---

## 💞 恋人・親友・家族関係での特例遷移

- 初期感情ラベルは「好き」
- → 「大好き」：非常に高好感度時、またはイベント連続発生
- → 「普通」：イベント未発生が続いた場合
- → 「嫌い」→「大嫌い」：大喧嘩イベントなど
- → 「別れたい」イベント（プレイヤー関与型）に接続

---

## 😶‍🌫️ 「気まずい」状態の特性

- どの状態からでもイベントで遷移可能（自由遷移）
- 一定時間経過でリセットされる
- 特定のイベントで元のラベルに戻ることも可能

---

## 📊 抽選確率のサンプルロジック（例：雑談イベント、関係ラベル：友達）

| 現在の感情ラベル | 好感度範囲 | 次の候補 | 抽選確率（%） |
|------------------|-------------|------------|----------------|
| なし              | 0–30         | 嫌いかも     | 15             |
| なし              | 30–70        | 気になる     | 25             |
| 気になる          | 70–100       | 好きかも     | 35             |
| 好きかも          | 任意         | （変化なし） | 70             |
| 嫌いかも          | 任意         | （変化なし） | 70             |

※すべて合計100%にはならず、「変化しない」70%を加えた上で、当選時の遷移先を抽選する。

---

## 🛠️ 実装上の処理イメージ（擬似コード）

```python
def handle_emotion_label_change(event_type, relation_label, current_emotion, favorability):
    if random() < 0.3:
        candidates = get_candidates(event_type, relation_label, current_emotion, favorability)
        return weighted_random_choice(candidates)
    else:
        return current_emotion  # 変化しない
```

---

## 📝 備考

- 関係ラベルの変化は、別途トリガーによって制御（プレイヤー非関与 or 関与型）
- 感情ラベルは一方向性（A→B）であり、B→Aとは別に扱う
- 実装時はCSVやDBテーブルで重み分布を保持し、イベントごとに読み込んで対応
