# 📘 テキストベース人間関係シミュレーション 統合仕様書（草稿）

---

## 1. はじめに

本仕様書は、テキストベースでキャラクター同士の人間関係をシミュレーションするアプリケーションの、UI設計・イベント仕様・内部処理・ロジックに関する全体仕様を統合的に記述したものである。各章では分野別に整理を行い、開発・保守・拡張に必要な情報を明示する。

---

## 2. UI設計仕様

本章では、各画面の構成、表示内容、導線、インタラクションを記述する。

### 2.1 メイン画面
- ログ（CLI風）・キャラクター一覧（横スクロール）を表示。
- 上部に「管理室」「日報」ボタン、右上に時刻・日付表示。
- ログはEVENT行・SYSTEM行・セリフからなり、タイピング風演出あり。
- 「みんなの様子」にはキャラ名と状態（例：就寝中）が表示され、クリックで詳細へ遷移。

### 2.2 プレイヤー介入イベント（困りごと）
- メイン画面内「みんなの様子」下、「ログ表示」の上に最大3件表示。
- 回答形式は選択肢式または穴埋め式。送信は一度限り。
- 回答後はキャラの返答を表示し、ログにEVENT・SYSTEM行が出力される。

### 2.3 キャラクターステータス画面
- 名前、MBTI、性格パラメータ（5項目）、状態を表示。
- 関係一覧は横スクロールで、関係ラベル・好感度バー・感情ラベルを含む。
- 最近のイベント履歴を最大5件まで簡易表示。

### 2.4 関係詳細画面
- キャラA⇄キャラB の関係ラベル・好感度（両方向）・感情ラベルを表示。
- 直近3〜5件のやり取り履歴を自然文で簡易表示。
- 編集不可、表示専用。

### 2.5 日報画面
- 日別にイベント発生とラベル変化履歴を表示。
- 日付・キャラ・変化タイプでフィルタ可能。
- 関係変化は双方向で、感情変化は片方向で記録。

### 2.6 管理室
- キャラ追加／編集／削除／情報確認が可能。
- 入力項目：名前、MBTI、性格パラメータ、話し方、興味ジャンル、初期関係設定。
- 編集フォームは折りたたみ式。閲覧モードでは読み取り専用。

### 2.7 ログ表示仕様
- セリフは1行ずつタイピング表示。
- EVENT行／SYSTEM行は強調色（SYSTEMはオレンジ系）。
- 未読ログがある場合は通知あり。
- 感情・関係・信頼度の変化はSYSTEM行で出力。

---

## 3. キャラクター仕様

### 3.1 基本構造
各キャラクターは以下の属性を持つ：
- 名前
- MBTI（16タイプ）
- 性格パラメータ（5種：社交性・気配り傾向・頑固さ・行動力・表現力）
- 話し方設定（プリセット＋カスタム欄）
- 興味関心ジャンル（タグ形式も可）
- 現在状態（例：就寝中・風邪など）

### 3.2 関係ラベル
キャラA⇄Bの双方向共通ラベル。以下の段階が存在：
1. なし
2. 認知
3. 顔見知り
4. 友達
5. 親友
6. 恋人

※ラベルはイベントによって変化し、初期設定やプレイヤー介入イベントによる調整も可能。

### 3.3 感情ラベル
キャラA→Bの片方向で1つだけ所持可能な感情ラベル。種類：
- なし（初期値）
- 気になる
- 好きかも
- 嫌いかも
- 気まずい

※「気まずい」は他ラベルと異なり、どの状態からも遷移・復帰が可能。

### 3.4 好感度
キャラA→Bの一方向で管理される数値（-100～+100）
- 初期値：0
- 日数経過による自然減少あり（接触4〜7日：-1、8日以上：-2）
- イベントによる変動はイベント種別ごとに設定（例：雑談 +5、喧嘩 -10）

### 3.5 信頼度（対プレイヤー）
キャラ→プレイヤーの一方向評価（0〜100）
- 初期値：性格により30〜70
- 回答イベント等での助言成功・失敗により±10などの変動
- 数値帯によりプレイヤーへの認識が変化

---

## 4. イベント仕様

本章では、ゲーム内におけるイベントの分類と各種イベントの詳細、及びそれに伴うパラメータ変化処理について記述する。

### 4.1 イベントの分類
イベントは大きく以下の2種に分類される：

- **非関与イベント**（観察専用）：キャラ同士が自動で行うやりとり。
- **プレイヤー介入イベント**（困りごと）：キャラがプレイヤーに相談する形式。

### 4.2 非関与イベント（自動発生型）

| イベント種別 | 対象関係 | 特徴 | 好感度変化 | 感情変化 |
|---------------|----------|------|--------------|------------|
| 挨拶 | 任意 | すれ違いざまなどで発生 | +1～+2 | なし（認知変化あり） |
| 初対面 | なし／認知 | 初会話・戸惑い重視 | +1 | なし |
| 雑談 | 友達以上 | 軽いテーマでのやりとり | +3 | 抽選あり（conversation） |
| 思い出し会話 | 友達以上 | 感情的な話・印象的な記憶 | +4 | 抽選あり（reminiscence） |
| 二人きりの時間 | 任意 | 親密な空気感・静かなやり取り | +3 | 抽選あり（alone_time） |

- 感情ラベル変化抽選は、関係ラベル・好感度・現在ラベルに応じて確率計算される（詳細：第5章）

### 4.3 プレイヤー介入イベント（困りごと）

- 発生時、キャラクター一覧下に表示（最大3件）
- 回答形式：選択肢または穴埋め文のテンプレート
- 回答は一度限りで、送信後に結果として信頼度が変化
- 結果はログに `EVENT`（相談）と `SYSTEM`（信頼度変化）として出力される
- 信頼度以外の変数には影響しない

### 4.4 イベントとラベル変化の関係

- 好感度：各イベント発生時に固定量増減（第3章参照）
- 感情ラベル：一部イベントにて抽選による変化が生じる
  - 雑談＝conversation
  - 思い出し会話／二人きりの時間＝memory_or_private
- 関係ラベル：
  - 挨拶イベントで「なし→認知」へ確定変化
  - 特定のイベントで「認知→友達」など段階的に変化（詳細は今後設計）

---

## 5. 内部処理・抽選仕様

### 5.1 好感度の処理
- 範囲：-100 ～ +100
- 初期値：0
- 自然減少ルール：
  - 接触4〜7日なし：-1／日
  - 接触8日以上なし：-2／日
- イベントによる固定変動：
  - 挨拶：+1～+2
  - 雑談：+5
  - 思い出し会話：+8
  - 二人きりの時間：+10
  - 喧嘩：-10（頑固さによっては-15）
  - 誤解・すれ違い：-5～-10

### 5.2 信頼度の処理
- 範囲：0 ～ 100
- 初期値：性格により30〜70
- 変化トリガー：
  - 助言成功：+10
  - 助言失敗：-10（納得していれば変化なしの場合も）
  - 雑談で好印象：+5（表現力・信頼度等によって発生確率が変動）
- プレイヤーに対する認識：
  - 0～30：「関わりたくない」
  - 31～60：「気になる変な存在」
  - 61～80：「たまに頼りたくなる存在」
  - 81～100：「一番信頼できる存在／神様のよう」

### 5.3 感情ラベルの抽選処理
- 対象イベント：
  - 雑談イベント（conversation）
  - 思い出し会話／二人きりの時間（memory_or_private）
- 抽選キー：
  - `(event_type, 関係ラベル, 現在の感情, 変化先ラベル)`
  - 好感度値をもとに補間された確率値で抽選を実施
- 変化遷移例：
  - 「なし」→「気になる」→「好きかも」
  - 「なし」→「嫌いかも」
  - 「恋人・親友」の場合：「好き」→「大好き」や「嫌い」→「大嫌い」など特別遷移
  - 「気まずい」はどの状態からも遷移可能（自然リセットあり）
- 変化しない確率：全体の約70％（残り30％が変化抽選）
- 抽選はA→B／B→Aで独立に実施

### 5.4 その他補足
- 好感度・信頼度ともに性格パラメータ（例：気配り・頑固さ）による補正あり（今後拡張）
- 特別イベント（誕生日・手紙など）による ±20 程度の変化も実装可能性あり

---

## 6. ログ・日報管理

### 6.1 ログ仕様
- 表示形式：CLI風（タイピング演出あり）
- ログ行の種類：
  - `EVENT:` 会話・行動イベント
  - `SYSTEM:` 感情ラベル・関係ラベル・信頼度の変化通知
  - セリフ：キャラの発言。インデント表示。名前は省略可能
- SYSTEM行は強調色（例：オレンジ系）で表示
- 未読ログがある場合、画面下部に「未読があります」表示
- セリフは1行ごとに表示。会話1往復は3〜6行程度が想定
- プレイヤーの選択結果や信頼度変化はSYSTEM行として簡潔に記録

### 6.2 日報仕様
- 日次単位で記録され、毎日0:00に切り替え
- 表示項目：
  - 発生イベント一覧（時刻・キャラ）
  - 関係ラベル・感情ラベル・信頼度の変化履歴
- フィルタ機能：
  - キャラ名、イベント種別、日付などで絞り込み可能
  - 初期状態では当日分のみ表示
- 変化記録の例：
  - 「10:03 彩花と碧が会話した」
  - 「碧→彩花：感情ラベル『なし』→『気になる』」
  - 「詠翔⇄響：関係ラベル『なし』→『友達』」

### 6.3 保存と遷移
- ログと日報のデータは内部保存され、セーブデータとして管理
- イベントや関係性変化の履歴はログと日報の両方に反映されるが、粒度が異なる
  - ログ：詳細な発言単位
  - 日報：1イベント1行の要約

---