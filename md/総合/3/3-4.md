### 3.4 感情ラベル仕様

#### 3.4.1 ラベルの種類と遷移構造

キャラクターA→Bに対して、以下のいずれか1種類の感情ラベルが付与される。
ラベルは\*\*片方向性（A→Bのみ）\*\*で、B→Aとは無関係である。

##### 通常関係（関係ラベルが「友達」など）

```
嫌いかも ← なし → 気になる → 好きかも
```

* 「気になる」は**接触がない期間が続くと自然にリセットされる**。
* 「好きかも」「嫌いかも」は自然には戻らず、**イベントによってのみ変化**する。

##### 特別関係（関係ラベルが「恋人」「親友」「家族」）

```
嫌い ← 普通 ← 好き（初期値）→ 大好き
```

* 初期状態は「好き」。
* 「大好き」状態からは、特定のイベントでのみ「嫌い」や「普通」に変化。
* 「大嫌い」状態に遷移した場合、**「別れたい」などの解除イベント**が発生する。

##### 特殊ラベル「気まずい」

* あらゆる関係・感情ラベルから遷移可能。
* **時間経過により自然にリセット**される。
* 特定のイベントを通じて、他の感情ラベルへと戻る場合もある。

##### 備考
なお、「通常系列」と「特別系列（恋人・親友・家族）」は**明確に分離**されており、感情ラベルの変化は原則として**同一系列内でのみ**発生する（例：「好きかも」→「大好き」などの直接的な移行は発生しない）。
特別系列への移行は、関係ラベルの変化により系列ごと切り替わることによってのみ起こる。 

#### 3.4.2 感情ラベルの変化タイミング

* 感情ラベルは以下のいずれかによって変化する：

  * **非関与イベント時の抽選**
  * **プレイヤー介入型イベント**
  * **時間経過（自然リセット）**

感情ラベルは、原則としてイベントを契機とした抽選によってのみ変化する。ただし、以下の2つのラベルは例外的に\*\*時間経過による自然変化（リセット）\*\*が発生する：

* 「気になる」：未接触状態が7日間継続すると、自動的に「なし」に戻る。
* 「気まずい」：通常系列・特別系列を問わず、未接触状態が7日間継続すると、自動的にリセットされる。

※ この「接触」は、雑談・思い出し会話・二人きりの時間イベントなど、ログに記録される会話系イベントが対象となる。
これらの変化は**抽選を伴わない**定常的な処理であり、ユーザーの操作有無にかかわらず進行する。

上記以外の感情ラベルについては、**時間による変化は一切発生しない**。

#### 3.4.3 感情ラベルのログ出力

感情ラベルが変化した際は、**キャラクター同士の会話ログとは別に**、以下の形式でシステム出力される：

```
SYSTEM: キャラA→キャラBの印象が「気になる」に変化しました。
```

※「ラベル」という語は使用せず、「印象」に言い換えて自然な文体とする。

#### 3.4.4 感情ラベルの変化抽選仕様

感情ラベルの変化は、イベントの発生時にのみ抽選される。抽選の有無や変化先は、以下の要素に基づいて決定される：

* イベント種別（雑談、思い出し会話、二人きりの時間など）
* 対象キャラクター間の関係ラベル（友達、恋人、親友、家族 など）
* 現在の感情ラベル、およびそこから遷移可能な変化先ラベル
* キャラクターA→B間の好感度（−100 ～ +100）

抽選は、各変化先ごとに定義された「好感度=20」「50」「80」の3点における代表的な変化確率（%）をもとに、好感度に応じて**線形補間**を行うことで、任意の好感度値における確率が算出される。

##### 変化確率の補間処理の例

```python
def 感情変化確率(好感度: float, P20: float, P50: float, P80: float) -> float:
    if 好感度 <= 20:
        return P20
    elif 好感度 <= 50:
        return P20 + (好感度 - 20) * (P50 - P20) / 30
    elif 好感度 <= 80:
        return P50 + (好感度 - 50) * (P80 - P50) / 30
    else:
        return P80
```

##### 抽選の処理単位

* イベント1回につき、定義されたすべての変化先ラベルに対して**個別に抽選**が行われる（同時当選は不可。発生優先度は別途定義）。
* 全体として、変化が起こる確率はおおよそ**30%前後**となるよう調整されている。
* 「通常系列（なし〜好きかも等）」および「特別系列（普通〜大嫌い等）」のいずれも、上記と同様の補間ロジックを使用する。

#### 3.4.5 感情ラベルと関係ラベルの連動仕様（暫定案）

感情ラベルの変化により、関係ラベル変化イベントが発生する可能性がある（例：「好きかも」状態での会話により告白イベントが発生し、関係ラベルが「恋人」になる）。
ただし、ラベル変化そのものは自動で起こらず、関係ラベルの遷移には**イベントを介したプレイヤー介入**が必須である。

今後のイベント設計において、感情ラベルをトリガーとする関係変化条件が設定される見込みである。

### 3.4.6 初期設定時の自動付与ロジック

感情ラベルは、キャラクター追加時に設定される関係ラベルおよび好感度に応じて、以下のルールに従い**自動的に初期値が決定される**。この処理は片方向（A→B）ごとに実施され、**プレイヤーが手動で編集することはできない**。

#### ✅ 通常関係（「認知」「友達」）

| 関係ラベル | 初期好感度 | 感情ラベル（A→B） |
|------------|-------------|------------------|
| 認知       | -50未満     | 嫌いかも         |
| 認知       | -49〜10     | なし             |
| 認知       | 11以上      | 気になる         |
| 友達       | -50未満     | 嫌いかも         |
| 友達       | -49〜15     | なし             |
| 友達       | 16〜59      | 気になる         |
| 友達       | 60以上      | 好きかも         |

#### ✅ 特別関係（「親友」「恋人」「家族」）

| 関係ラベル     | 初期好感度 | 感情ラベル（A→B） |
|----------------|-------------|------------------|
| 親友／恋人／家族 | -50未満     | 嫌い             |
| 親友／恋人／家族 | -49〜30     | 普通             |
| 親友／恋人／家族 | 31〜69      | 好き             |
| 親友／恋人／家族 | 70以上      | 大好き           |

> ※ 感情ラベル「気まずい」「大嫌い」は初期設定では付与されず、イベントまたは時間経過により変化するものとする。