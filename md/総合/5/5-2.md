### 5.2 時間帯補正仕様

本節では、ゲーム内の時間帯（朝・昼・夜など）に応じたイベント発生補正ロジックについて記述する。時間帯はイベント抽選時に使用され、発生率やキャラの行動傾向に影響する。

#### 5.2.1 時間帯の区分

ゲーム内の時間は24時間制で扱われ、以下の時間帯に分類される。

| 時間帯名 | 時刻範囲（例）     |
| ---- | ----------- |
| 朝    | 05:00～10:59 |
| 昼    | 11:00～15:59 |
| 夕方   | 16:00～18:59 |
| 夜    | 19:00～23:59 |
| 深夜   | 00:00～04:59 |

※ 各キャラクターの活動傾向は、以下の時間帯分類に基づいて補正される。

#### 5.2.2 ベース発生率補正（全体）

時間帯ごとの基本発生倍率（全キャラ共通）は以下のとおり：

| 時間帯 | 補正倍率 |
| --- | ---- |
| 朝   | 0.7  |
| 昼   | 1.0  |
| 夕方  | 1.2  |
| 夜   | 1.1  |
| 深夜  | 0.5  |

この倍率は、イベント候補の基本発生重みに掛けて適用される。

#### 5.2.3 キャラクター活動傾向の補正

各キャラには「活動傾向（activityPattern）」として、以下のいずれかが設定される：

* `normal`（標準型）
* `morning`（朝型）
* `night`（夜型）

これに応じて、時間帯ごとの補正倍率に追加でキャラごとの個別補正がかかる。

| 活動傾向 \ 時間帯 | 朝    | 昼    | 夕方   | 夜    | 深夜   |
| ---------- | ---- | ---- | ---- | ---- | ---- |
| normal     | ×1.0 | ×1.0 | ×1.0 | ×1.0 | ×1.0 |
| morning    | ×1.3 | ×1.1 | ×1.0 | ×0.9 | ×0.7 |
| night      | ×0.7 | ×0.9 | ×1.0 | ×1.1 | ×1.3 |

※ 補正は「全体倍率 × キャラ個別倍率」として掛け合わせて適用。

#### 5.2.4 実装形式（補正計算）

擬似コード：

```ts
function getFinalWeight(baseWeight, timeSlot, activityType) {
  const global = globalTimeModifiers[timeSlot];
  const personal = personalTimeModifiers[activityType][timeSlot];
  return baseWeight * global * personal;
}
```

補正係数は外部からJSONで管理可能：

```json
{
  "globalTimeModifiers": {
    "morning": 0.7,
    "noon": 1.0,
    "evening": 1.2,
    "night": 1.1,
    "midnight": 0.5
  },
  "personalTimeModifiers": {
    "normal": {
      "morning": 1.0, "noon": 1.0, "evening": 1.0, "night": 1.0, "midnight": 1.0
    },
    "morning": {
      "morning": 1.3, "noon": 1.0, "evening": 1.0, "night": 0.7, "midnight": 0.7
    },
    "night": {
      "morning": 0.7, "noon": 1.0, "evening": 1.0, "night": 1.1, "midnight": 1.3
    }
  }
}
```

#### 5.2.5 備考

* `activityPattern` はキャラクターデータ（6.2）に設定される。
* 補正はすべて「発生候補評価時（イベント種別ごとの重み算出時）」に使用される。
* 一部イベント（就寝・風邪・相談など）は時間帯補正の影響を受けずに発生する。