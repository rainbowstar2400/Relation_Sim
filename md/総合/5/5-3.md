## 5.3 感情ラベルの抽選

本節では、キャラクター間のイベント終了時に発生する「感情ラベル」の変化について、その抽選ロジックと実装方針を示す。

---

### 5.3.1 概要

キャラクター間の感情ラベルは、イベント発生時の印象や好感度に応じて、一定確率で変化する可能性がある。
変化は必ずしも発生するわけではなく、**排他的抽選（1つのみ当選）**によって実施される。

抽選は、対象イベントの終了直後に実行され、該当する場合のみログに明記される。

---

### 5.3.2 抽選対象となるイベント種別

以下のイベント種別が、感情ラベル変化抽選の対象である。

- 雑談イベント
- 二人きりの時間イベント
- 思い出し会話イベント
- 挨拶イベント（※ただし変化率はかなり低く設定）

プレイヤー介入イベント（困り事相談など）では、感情ラベルの変化は発生しない。

---

### 5.3.3 抽選処理の流れ（標準処理）

1. **抽選対象の確認**  
   該当イベント種別であるかを確認し、対象であれば抽選を実施。

2. **雰囲気（仮称）の決定**  
   イベント発生時に抽選された「会話の雰囲気（とてもポジティブ〜とてもネガティブの5段階）」により、感情変化テーブルを選定。

3. **感情ラベル変化の抽選**  
   好感度・関係ラベルに応じた変化候補とその確率を取得し、1～100の整数からランダムで1つを選出。
   その値がどの範囲に入るかで変化内容を決定する。

   （例）  
   - 雰囲気：普通  
   - 関係ラベル：友達  
   - 好感度：+20  
   - 感情ラベル：なし  

   → 抽選テーブル（仮）：
     - 気になる：5%
     - 嫌いかも：5%
     - 気まずい：5%
     - 変化なし：85%

   ランダムで「4」が出た場合、「気になる」に変化。

4. **ログ出力**  
   変化があった場合のみ、ログに以下のような記載を行う：

   ```
   SYSTEM: A→Bの印象が「気になる」に変化しました。
   ```

---

### 5.3.4 雰囲気による補正（導入予定）

イベントには「雰囲気（仮称）」パラメータを導入予定である。
これはGPTプロンプトに反映されるだけでなく、抽選にも直接影響を与える。

雰囲気は、イベント発生時にイベント種別・関係ラベル・好感度などを元に抽選され、以後そのイベント中は固定される。
雰囲気ごとに抽選テーブルが異なるため、同じ好感度でも変化率が上下する仕組みとなる。

この仕様により、会話と結果の整合性がより高まり、プレイヤーの納得感や演出の説得力を担保できるよう設計している。

※詳細仕様は「5.3.4 感情ラベル抽選における雰囲気パラメータの導入（構想）」にて別途記載。

---

### 5.3.5 補足事項

- 感情ラベルの変化はキャラA→Bの片方向のみ処理される。
- 関係ラベルが「恋人」「親友」などでも感情ラベルの変化は発生しうる。
- すでに特定の感情ラベルを持っている場合でも、他ラベルに上書き変化することがある。
- 「気になる」「気まずい」は時間経過で自然にリセットされる特殊な感情ラベルであるが、イベントにより他ラベルへ変化することもある。