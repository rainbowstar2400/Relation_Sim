# テキストベース人間関係シミュレーション 統合仕様書

## 1.はじめに

### 1.0 本仕様書の目的

本仕様書は、本シミュレーションアプリケーションの機能、構造、および内部処理の設計内容を明示することを目的とする。本アプリは、複数のキャラクター同士の関係性や会話の推移を、リアルタイムで観察・管理する形式のテキストベースのシミュレーションである。

プレイヤーは「管理人」として、媒体越しにキャラクターたちのやり取りを見守りながら、必要に応じて特定のイベントに介入する役割を担う。

---

### 1.1 システム全体概要

本アプリは主に以下の要素から構成される：

- **UI画面**：キャラクターの様子、ログ、イベントなどを確認・管理するための画面群
- **キャラクター管理**：性格・関係性・状態の登録と編集
- **イベント生成・表示**：時間帯や性格等に応じた会話イベントの自動発生
- **信頼度・好感度・ラベル変化処理**：関係や感情の変化を制御する機構
- **ログと日報**：会話やラベル変化を記録し、振り返りを可能とする
- **セーブ・ロード機能**：プレイ内容の保存・復元を行う

本アプリはWebベースのローカルアプリケーションとして設計されており、インターネット接続を必要とせず、単体で動作する。

---

### 1.2 用語の定義

- **キャラクター**：プレイヤーが管理・観察対象とする仮想存在。複数存在し、互いに関係を持つ。
- **プレイヤー**：キャラクターたちに干渉可能な上位存在。主に困り事相談への対応などで介入する。
- **関係ラベル**：キャラクター同士の関係性（例：なし／認知／友達／親友／恋人／家族）を示す。
- **感情ラベル**：キャラクターA→Bにおける一時的な印象や感情（例：気になる／嫌いかも／気まずいなど）を示す。
- **信頼度**：キャラクター→プレイヤー間に存在する単一方向の数値指標。
- **好感度**：キャラクターA→B間に存在する単一方向の数値指標。

---

### 1.3 本仕様書の構成

本仕様書は以下の章構成で構成される：

- **第1章：はじめに** … システム全体の概要と用語の整理
- **第2章：UI仕様** … 各画面の構成とUI要素の設計
- **第3章：キャラクター仕様** … キャラクター同士の関係・感情の構造と変化
- **第4章：イベント仕様** … 会話イベントの分類と仕様
- **第5章：内部処理・抽選仕様** … ラベル変化・好感度変化・抽選処理の詳細
- **第6章：データ構造と保存仕様** … 内部データの構成と保存・読み込み方式

---

## 2.UI仕様

### 2.1 メイン画面 UI設計仕様書（再整理版）

#### 2.1.1 画面の目的

* キャラクターの状態観察とログ閲覧を主目的とした、アプリの中心ビュー。
* 管理室や日報など、他機能への導線を兼ねる。
* SPA的構造でありながら、UI上はページ遷移風の構成。

#### 2.1.2 画面構成概要（全体）

```
┌──────────────────────────────────────────────┐
│ [管理室] [日報]                           〔時刻表示〕〔日付表示〕   │
├──────────────────────────────────────────────┤
│ ▼ みんなの様子（キャラ一覧・横スクロール）                        │
│ ┌────┬────┬────┬────┐                              │
│ │ キャラA │ キャラB │ キャラC │ キャラD │  → スクロール可         │
│ └────┴────┴────┴────┘                              │
│  ※クリックで詳細ステータスへ                                      │
├──────────────────────────────────────────────┤
│ ▼ 困りごと相談エリア                                             │
│ ・彩花から相談があります ▶︎ [対応する]                            │
│ ・志音が困っているようです ▶︎ [対応する]                         │
│ ［＋ 相談をさらに受ける］                                         │
├──────────────────────────────────────────────┤
│ ▼ ログ表示エリア（CLI風）                                         │
│ [08:42] EVENT: 莉音と咲が会話中…                                 │
│         莉音「ねぇ、あの本、読んだ？」                            │
│         咲「えっ、まだだけど、面白かった？」                     │
│ [08:45] SYSTEM: 信頼度が上昇しました。                           │
│ ……                                                              │
└──────────────────────────────────────────────┘
```

#### 2.1.3 各構成要素の仕様

##### 🔹 上部メニュー

| 項目    | 説明                    |
| ----- | --------------------- |
| 管理室   | キャラの追加・編集・削除用ビューへの導線  |
| 日報    | 日別・キャラ別イベントを確認できる画面   |
| 時刻・日付 | 右上にリアルタイムで表示（現実時間と同期） |

##### 🔹 みんなの様子（キャラ一覧）

| 項目   | 説明                             |
| ---- | ------------------------------ |
| 表示形式 | 横スクロール可能なカード型表示                |
| 表示内容 | キャラ名（必須）＋状態（例：「風邪」「就寝中」などテキスト） |
| 遷移機能 | 各カードクリックでキャラステータス画面に遷移         |

##### 🔹 困りごと相談エリア（プレイヤー介入イベント）

| 項目     | 内容                                    |
| ------ | ------------------------------------- |
| 表示位置   | ログ表示エリアの上、キャラ一覧の下に配置                  |
| 表示内容   | キャラ名と簡易相談文、「対応する」ボタン（1イベント1行）＋追加ボタン   |
| 初期表示件数 | 最大2件、明示操作により最大3件まで                    |
| 消滅処理   | 約1時間で未対応の相談は自動的に非表示                   |
| 遷移後動作  | 回答ポップアップ（別仕様：2.4節）を開き、回答完了後にキャラの返答を表示 |
| ログ出力   | 回答完了時にログへ反映（セリフは非表示）                  |

##### 🔹 ログ表示エリア（CLI風）

| 項目     | 内容                                  |
| ------ | ----------------------------------- |
| 表示スタイル | CLI風（タイピング演出＋色分け）                   |
| ログ形式   | `EVENT:` 会話・行動など／`SYSTEM:` 信頼度や感情変化 |
| 既読処理   | 未読があるとき「未読あり」表示、スクロールで既読化           |

---

### 2.2 キャラステータス画面

#### 2.2.1 概要

* キャラクターの現在状態・関係性・性格パラメータを閲覧可能な専用ビュー。
* 編集機能は持たず、閲覧専用である。
* キャラ一覧（みんなの様子）から遷移する形で表示。

#### 2.2.2 画面構成（例）

```
┌──────────── ステータス画面（キャラA） ─────────────┐
│ 名前：碧                                               │
│ 性格タイプ：INFP                                       │
│ 話し方：くだけた（一人称：俺、語尾：〜じゃん）          │
│ 現在状態：風邪                                          │
│                                                       │
│ ▼ 性格パラメータ                                       │
│   社交性：■■■■□    気配り：■■■□□                       │
│   頑固さ：■■□□□    行動力：■■■■■                       │
│   表現力：■■■■□                                       │
│                                                       │
│ ▼ 関係一覧（横スクロール・簡易表示）                     │
│   彩花：関係ラベル「友達」｜好感度 [■■■■□]｜気になる     │
│   志音：関係ラベル「認知」｜好感度 [■■□□□]｜なし         │
│   （クリックで個別詳細ページへ遷移）                       │
│                                                       │
│ ▼ イベント履歴（最近5件）                               │
│   - 6/29 彩花と会話した                                │
│   - 6/28 志音とすれ違った                              │
│   - 6/28 志音と会話した                                │
│   - 6/27 彩花と会話した                                │
│   - 6/27 志音と会話した                                │
└────────────────────────────────────┘
```

#### 2.2.3 詳細仕様

##### 🔸 基本情報

| 項目   | 表示形式                        |
| ---- | --------------------------- |
| 名前   | 太字表示                        |
| MBTI | タイプ名（例：INFP）                |
| 話し方  | プリセット名＋カスタム欄（例：「丁寧（私、ですわ）」） |
| 現在状態 | テキスト（例：「就寝中」「風邪」「活動中」など）    |

##### 🔸 性格パラメータ

* 5段階バー表示（視覚的にスライダーまたはブロック表示）
* 対象項目：

  * 社交性
  * 気配り傾向
  * 頑固さ
  * 行動力
  * 表現力

##### 🔸 関係一覧

| 項目   | 内容                       |
| ---- | ------------------------ |
| 表示形式 | 横スクロール型のキャラカード           |
| 表示内容 | 対象キャラ名、関係ラベル、好感度バー、感情ラベル |
| 遷移機能 | 各キャラをクリックすると、個別関係詳細画面へ遷移 |

##### 🔸 イベント履歴

| 項目   | 内容                            |
| ---- | ----------------------------- |
| 表示件数 | 最大5件まで                        |
| 表記形式 | 「日付＋対象キャラ＋概要」例：「6/29 彩花と会話した」 |
| 補足   | 詳細な会話内容等は表示せず、ログ画面と分離する       |

#### 2.2.4 備考

* 本画面は情報表示専用であり、編集操作は不可。
* キャラの編集は「管理室」画面から行う（別章に記述）。
* 関係ラベルや感情ラベルの定義はイベントや内部処理仕様を参照。

---


### 2.3 キャラ関係詳細画面

#### 2.3.1 画面の目的

* キャラクターA⇄Bの**相互関係性の詳細表示**を行う専用ビュー。
* 「関係ラベル」「好感度（片方向）」「感情ラベル（片方向）」を左右対称で見やすく提示。
* 直近の関係イベント履歴を**自然文形式で簡易的に表示**し、状態変化の参照を可能にする。

#### 2.3.2 表示構成（UIイメージ）

```
┌──────────── キャラA⇄キャラB 関係詳細 ─────────────┐
│ キャラA：碧                          ⇄  キャラB：彩花           │
│ 関係ラベル：友達                                                 │
│ 好感度（碧→彩花）：■■■■□（67/100）                         │
│ 感情ラベル（碧→彩花）：気になる                              │
│ 好感度（彩花→碧）：■■■■■（88/100）                       │
│ 感情ラベル（彩花→碧）：好きかも                              │
│                                                            │
│ ▼ 最近のやり取り履歴（簡易表示）                         │
│ ・6/29 彩花と会話                                          │
│ ・6/27 碧と過ごした                                       │
│ ・6/24 初対面                                             │
└────────────────────────────────────┘
```

#### 2.3.3 項目仕様

##### 🔹 キャラクター基本情報

| 表示項目       | 内容                                |
| ---------- | --------------------------------- |
| キャラ名（A/B）  | 画面の左右に表示。ステータス画面からの遷移時に確定済み。      |
| 関係ラベル      | 「なし」「認知」「友達」など、**双方向同値**ラベル。    |
| 好感度（A→B）   | 数値（-100〜+100）＋バー表示。       |
| 感情ラベル（A→B） | 「気になる」「好きかも」「気まずい」など。片方向の感情状態を表示。 |

※左右対称に、A→B、B→A 両方向が明示される。

---

##### 🔹 関係履歴表示

| 項目    | 内容                         |
| ----- | -------------------------- |
| 内容    | 直近の関係イベントを自然文で3〜5件表示       |
| 表記例   | 「6/29 彩花と会話した」「6/27 碧と過ごした」  |
| 非表示項目 | 発端キャラ・イベント種別などの内部分類情報は非表示  |
| 編集不可  | 閲覧専用。ログ編集や詳細展開はこの画面には実装しない |

#### 2.3.4 備考・遷移元など

* この画面は**キャラステータス画面内の「関係一覧」からアクセス**。
* 編集機能は持たず、**完全に表示専用ビュー**とする。
* 今後の拡張として、重大イベントリンク・会話ダイジェスト導線などの追加余地あり。

---

### 2.4 プレイヤー介入イベント UI設計仕様書（再整理版）

#### 2.4.1 画面の目的

* キャラクターからプレイヤーへの「困りごと」相談を提示し、**1回限りの介入**を可能にするUIである。
* 回答内容によって信頼度が変動し、結果は**ログに反映**される。
* UI構成上は**メイン画面内の一部コンポーネント**として実装される。

#### 2.4.2 メイン画面内での配置と表示条件

| 項目     | 内容                            |
| ------ | ----------------------------- |
| 表示位置   | メイン画面中央部、「みんなの様子」下、「ログ表示エリア」上 |
| 表示条件   | イベントが存在する場合のみ（最大3件まで）         |
| 初期表示件数 | 初回：2件（追加はボタンにて）               |
| 自動消滅   | 未対応相談は約1時間で自動的に非表示となる         |

#### 2.4.3 表示構成（概要エリア）

```
▼ 困りごと相談エリア
─────────────────────────────
・彩花から相談があります ▶︎ [対応する]
・志音が困っているようです ▶︎ [対応する]
［＋ 相談をさらに受ける］
─────────────────────────────
```

* 「＋相談をさらに受ける」クリックで追加表示（最大3件まで）

#### 2.4.4 回答ポップアップ構成

##### 【共通構成】

```
┌─────────────── 困りごと ───────────────┐
│ 彩花「〇〇を──したくて、どうしたらいいかな？」         │
│                                                         │
│ ▼ 回答形式（選択肢 or 穴埋め）                          │
│ [形式A] 選択肢式                                       │
│   ・A：とりあえずやってみたら？                        │
│   ・B：誰かに相談してみるのはどう？                    │
│   ・C：ちょっと休むのもありだと思うよ                  │
│                                                         │
│ [形式B] 穴埋め式（1文定型：空欄1つ）                    │
│   「〇〇のときは、＿＿＿＿＿＿＿するといいよ。」        │
│                                                         │
│ [送信する]（一度のみ・確定後は再回答不可）              │
└────────────────────────────────────┘
```

* 回答終了後はキャラの自然な返答（「ありがとう！」など）を表示し、ポップアップを閉じる。

#### 2.4.5 ログ出力仕様

* 回答結果はログに出力される（会話内容やセリフは含まない）：

```
[10:21] EVENT: 彩花がプレイヤーに相談しています…
[10:23] SYSTEM: 彩花からの信頼度が上昇しました。
```

* 表示対象：イベント発生・信頼度変動などの「事実」
* 表示対象外：セリフ本文・感情表現・プレイヤー回答内容

#### 2.4.6 その他補足

* 回答形式は**相談テンプレートごとに指定**されており、選択式または穴埋め式のいずれか。
* 相談イベントは**履歴上はログにのみ記録**され、日報や画面上での個別記録は行わない。
* 信頼度以外の内部パラメータ（感情ラベル、関係ラベル）には影響しない。

---

### 2.5 日報画面

#### 2.5.1 概要

* 日付ごとに、その日に発生したイベントやラベル変化を一覧で確認できる画面。
* 「発生イベント一覧」と「ラベル変化履歴」を分けて表示。
* フィルターにより、日付・キャラクター・変化種別で絞り込み可能。

#### 2.5.2 画面構成イメージ

```
┌─────────────── 日報（2025/06/29） ───────────────┐
│ ▼ フィルター                                                │
│ [日付：2025/06/29] [キャラ選択 ▼] [変化タイプ ▼]     │
│                                                            │
│ ▼ 発生イベント一覧（簡易表示）                             │
│ ・10:03 彩花と碧が会話した                                 │
│ ・15:42 志音が響を見かけた                                │
│                                                            │
│ ▼ ラベル変化履歴                                            │
│ ・碧→彩花：感情ラベル「なし」→「気になる」                │
│ ・詠翔⇄響：関係ラベル「なし」→「友達」                    │
└────────────────────────────────────┘
```

#### 2.5.3 機能詳細

##### 🔸 フィルター

| 項目    | 内容                             |
| ----- | ------------------------------ |
| 日付    | カレンダーUIまたは前日/翌日ボタンで切替          |
| キャラ選択 | チェックボックスまたはドロップダウン（複数選択可）      |
| 変化タイプ | 「関係ラベル」「感情ラベル」「イベント」のいずれかを選択可能 |

##### 🔸 発生イベント一覧

* 時刻＋キャラクター名を使った簡易記述（最大10件、スクロール可）
* イベントの種類は非表示（詳細ログ画面へ遷移可能）
* 表記例：

  * 「10:03 彩花と碧が会話した」
  * 「15:42 志音が響を見かけた」

##### 🔸 ラベル変化履歴

* 感情ラベルは一方向で表示（例：「碧→彩花」）
* 関係ラベルは双方向をまとめて表記（例：「詠翔⇄響」）
* 表記例：

  * 「碧→彩花：感情ラベル『なし』→『気になる』」
  * 「詠翔⇄響：関係ラベル『なし』→『友達』」

#### 2.5.4 備考

* 初期表示は「当日（または最新）」の日付で表示
* イベント記録は内部ログと連動
* 各記録をクリックすると、該当ログの詳細ビューに遷移可能（拡張予定）

---

### 2.6 管理室（キャラクター管理ページ）

#### 2.6.1 概要

* キャラクターの追加・編集・削除、および情報確認を行うためのページ。
* 性格診断や初期関係の設定も含まれ、キャラクター初期化における中核的役割を担う。

#### 2.6.2 画面構成

```
┌──────────── 管理室 ─────────────┐
│ [＋キャラクター追加]（クリックでフォーム展開）                │
│ ────────────────                             │
│ ▼ 既存キャラクター一覧（名前順・操作ボタン付き）              │
│   - 葵      [情報] [編集] [削除]                            │
│   - 彩花    [情報] [編集] [削除]                            │
└──────────────────────────────┘
```

#### 2.6.3 キャラクター追加フォーム

| 項目       | 入力形式                                |
| -------- | ----------------------------------- |
| 名前       | テキスト入力欄                             |
| MBTI     | 診断スタートボタン（スライダー形式）または選択入力           |
| 性格パラメータ  | スライダー（1〜5）×5項目（社交性／気配り／頑固さ／行動力／表現力） |
| 話し方      | ラジオボタン＋自由記述欄（口調・語尾・一人称等）            |
| 興味関心ジャンル | テキスト入力（タグ形式も検討）                     |
| 初期関係設定   | 他キャラをプルダウン選択＋関係タイプ指定（例：兄弟・親・幼なじみなど） |

* 「追加」ボタンは必須項目がすべて入力された場合に限り有効化される。

#### 2.6.4 各種モード仕様

##### 📖 情報モード

* \[情報] ボタンで表示。
* 編集フォームと同じ構成だが全項目が読み取り専用。
* 操作ボタン（保存など）は非表示または非活性化。
* ステータス画面の流用基盤にもなる。

##### ✏️ 編集モード

* \[編集] ボタンで表示。
* すべての項目を編集可能（※「名前」欄は固定または要検討）。
* 既存キャラデータを事前入力済みの状態で表示。

##### ❌ 削除モード

* \[削除] ボタンで確認ダイアログを表示。
* OK選択でキャラクター削除、キャンセルで操作中止。

#### 2.6.5 備考

* 初期関係設定は、「関係ラベル」「好感度」「感情ラベル」の初期値生成に影響を与える。
* MBTI診断結果をもとに性格パラメータを自動割り当てする機能も検討中。
* 編集時に既に削除されたキャラが関係先に存在する場合、関係の無効化または再設定を促す。

---

### 2.7 ログ画面（CLI風ログ）

#### 2.7.1 概要

* 会話・イベントの履歴を「CLI風ログ」として表示する画面。
* EVENT（イベント発生）／SYSTEM（状態変化）を主軸に構成。
* セリフ表示はログ内でインデント・改行あり。
* タイピング風アニメーションを適用。

#### 2.7.2 表示内容

* EVENT: イベント（会話など）の開始を示す。
* セリフ: キャラ同士の発言（インデントあり）。
* SYSTEM: 状態変化（感情ラベル・関係ラベル・信頼度など）。

```plaintext
[08:42] EVENT: 莉音と咲が会話中…
            莉音「ねぇ、あの本、読んだ？」
            咲「えっ、まだだけど、面白かった？」
[08:45] SYSTEM: 信頼度が上昇しました。
[08:47] SYSTEM: 莉音→咲の感情ラベルが「気になる」に変化しました。
```

#### 2.7.3 表示スタイル

* EVENT行／SYSTEM行は色分け・強調表示。

  * SYSTEM行は橙系カラー（例：#FFA500）。
* セリフは改行・字下げあり（キャラ名は省略可）。
* 未読ログがある場合、下部に「未読があります」表示。

#### 2.7.4 表示順と並び替え

* ログ表示順は「新しい順」「古い順（時系列順）」を切替可能。
* 初期設定は最新順表示。

#### 2.7.5 備考

* ログに表示されるのは概要と結果のみ。

  * セリフありイベントでも詳細プロンプトや選択肢等は記録されない。
* プレイヤーへのフィードバック（信頼度変化など）は SYSTEM 行で簡潔に伝える。
* 数値は表示せず、「～が変化しました」と記載。

---

## 3.キャラクター仕様

### 3.1 基本情報と性格プロファイル

キャラクターは、プレイヤーが管理する対象であり、以下のような基本情報と性格パラメータを持つ。

#### 3.1.1 基本情報

* **名前**：キャラクターごとに設定可能な表示名。ゲーム内すべてのUIで使用される。
* **話し方**：口調や文体の設定。プリセット（例：「ていねい」「くだけた」）から選択可能で、カスタムも可。会話生成時のトーンに影響。

#### 3.1.2 MBTIタイプ

* キャラクターの性格傾向を表現するため、16Personalitiesに基づくMBTIタイプ（例：INFP、ESTJなど）を採用。
* MBTIの設定方法は以下の2通りから選択できる：

  1. **スライダー診断による自動推定**
     キャラ作成時に提示される5段階スライダー質問（例：「一人の方が落ち着く？」「予定は細かく立てたいタイプ？」など）に回答することで、自動的にMBTIタイプが決定される。
  2. **手動入力による直接設定**
     プレイヤーが任意のMBTIタイプを直接指定することも可能。自動推定と併用して、後から修正することもできる。
* 設定されたMBTIは、イベントの発生傾向や会話内容、性格パラメータとの整合性などに間接的に影響する。

#### 3.1.3 性格パラメータ（5種）

MBTIとは別に、キャラクターには以下の5項目に関する**性格パラメータ**が存在する。各項目は1〜5段階の整数値で構成される。これらは MBTI とは独立して設定されるが、合わせて性格全体を構成する。

| パラメータ名 | 概要               | ゲーム内での主な影響          |
| ------ | ---------------- | ------------------- |
| 社交性    | 他人との関係構築の積極性     | 雑談・挨拶イベントの発生頻度に影響  |
| 気配り傾向  | 他者への共感や配慮の度合い    | 感情ラベル変化や優しさ描写に影響    |
| 頑固さ    | 自己主張の強さ、意見の曲げにくさ | 関係変化時の対立や意見交換描写に影響  |
| 行動力    | 行動の速さ・イベントの主導傾向  | イベントの発端キャラとしての頻度に影響 |
| 表現力    | 感情や考えの言語的表出の豊かさ  | 会話の長さや表現の彩度に影響      |

* これらの値は、キャラ作成時にスライダーで設定することで決定される。
* 各パラメータ値は管理室にて後から編集可能。ただし、編集履歴や性格変化イベントによる変更は現仕様では非対応。

#### 3.1.4 その他仕様との連携

* 性格プロファイルは、イベント発生確率やGPTによる会話生成（話し方や内容）に影響を与える重要パラメータである。
* これらの情報は、**キャラクター作成画面**および**管理室画面**で設定・編集・閲覧が可能。
* これらの情報はキャラステータス画面にも一部反映される（話し方、MBTI、性格パラメータ）。

---

### 3.2 関係ラベルと初期関係

キャラクター同士の関係性は、**双方向同値の関係ラベル**によって管理される。これらのラベルは、特定のイベントまたは管理操作を通じて段階的に変化し、キャラクター間の親密度や関係の質を明確に表現するための指標である。

#### 3.2.1 関係ラベルの定義と構造

関係ラベルは以下のような段階構造を持ち、キャラA⇄Bの間で同一のラベルが設定される：

```
なし → 認知 → 友達 → 親友 ／ 恋人 ／ 家族（排他的）
```

* **「なし」**：初期状態。互いを認識していない関係。
* **「認知」**：名前や姿を知っている状態。
* **「友達」**：基本的な信頼関係が構築された状態。
* **「親友」「恋人」**：高い信頼と特別な絆を意味する。

  * 「親友」は観察型イベントによって成立。
  * 「恋人」は**プレイヤー介入型イベント**（告白イベント）を通じてのみ成立。
* **「家族」**：他のすべての関係ラベルと**排他的**であり、同時に保持できない特別な関係。初期設定または管理室での手動設定によりのみ付与される。

#### 3.2.2 関係ラベルの変化と発生イベント

関係ラベルは以下の遷移を通じて変化し、そのきっかけは**イベント発生**または**管理操作**による：

| 遷移      | 発生要因            | プレイヤー関与     |
| ------- | --------------- | ----------- |
| なし → 認知 | 挨拶イベント／時間経過     | 不要（自動）      |
| 認知 → 友達 | 「友達になるイベント（仮称）」 | 不要（観察型）     |
| 友達 → 親友 | 「親友になるイベント（仮称）」 | 不要（観察型）     |
| 友達 → 恋人 | 告白イベント          | **必要（介入型）** |
| ― → 家族  | 初期設定／管理室手動設定    | 任意（UI操作）    |

* \*\*「なし→認知」\*\*のみ時間経過やイベントでの自然変化が起こる。
* 「親友」は観察型イベントによってのみ到達し、プレイヤーの操作は不要。
* 「恋人」は**プレイヤーが選択肢などで関与することで成立**する唯一の関係ラベルである。
* 「家族」はイベントによって変化することはなく、明示的な設定によってのみ付与される。

#### 3.2.3 関係ラベルの併存制限と優先順位

* **「親友」「恋人」「家族」**は**相互に排他的**であり、いずれか一つのみを保持可能。
* 特に「家族」関係を設定した場合、他の関係ラベルは同時に保持できない。
* 既存のラベルが存在する場合、「家族」ラベルを設定すると**既存ラベルは上書きされる**（逆も同様）。

#### 3.2.4 解除と別れイベントの予定

関係ラベルは一方向に進むのみではなく、将来的には「別れ（仮称）」イベントなどを通じて**解除・逆転が可能となる予定**である。

* 例：「親友」→「友達」への降格など
* プレイヤーが関与する選択肢型イベントや、長期未接触による強制変化なども検討中。

（現時点では未実装であり、将来拡張に備えたフックのみを用意）

#### 3.2.5 初期関係設定機能

関係ラベルは、キャラクター追加時または管理室画面において初期設定することが可能である。

* **追加時**：既存キャラとの関係性として「なし」「認知」「友達」「親友」「恋人」「家族」から選択可。
* **管理室**：後から「家族」を含む初期関係を再設定することも可能。
* イベントによる変化とは無関係に、プレイヤーが任意に調整できる。

#### 3.2.6 表示と通知仕様

* 関係ラベルは、キャラステータス画面およびキャラ関係詳細画面に表示される。

  * ステータス画面では一覧形式で簡潔に表示。
  * 詳細画面では、ラベルの変化履歴を含めた経過を確認可能。
* ラベルが変化した際には、ログ上に以下のようなSYSTEM行が表示される：

```
SYSTEM: AとBの関係が『恋人』になりました。
```

---

### 3.3 好感度仕様

好感度は、キャラクターAがキャラクターBに対してどれほど好意・親近感を抱いているかを表す数値であり、**A→Bの片方向**で定義される。関係ラベルや感情ラベルの変化にも間接的に影響を与える、シミュレーションにおける中核的な内部パラメータである。

#### 3.3.1 数値仕様

* **値の範囲**：`-100 ～ +100`
* **方向性**：原則としてプラス方向（上昇傾向）で推移するが、関係悪化イベント等によりマイナス域に至ることもある。
* **非対称性**：A→BとB→Aは**独立して管理**され、互いに影響しない（片想いや一方的な好意も表現可能）。

#### 3.3.2 初期好感度の設定方法

キャラクター追加時や管理室での初期関係設定の際に、**好感度も同時に設定可能**とする。これにより、すでに親しい（あるいは対立している）関係性を自然な数値で表現できる。

* プレイヤーは、**A→B、B→Aの片方向ごとにスライダー形式で数値を設定**する。
* スライダーの範囲は `-100～+100`、初期値は関係ラベルに応じて**自動的に提案される**。

例（UIイメージ）：

```
▼ 初期関係：恋人
　→ A→B 好感度：[ 50 ]　　B→A 好感度：[ 50 ]
　（スライダーで調整可能）
```

| 関係ラベル | 提案される初期好感度 |
| ----- | ---------- |
| なし    | 0          |
| 認知    | 5          |
| 友達    | 20         |
| 親友    | 40         |
| 恋人    | 50         |
| 家族    | 50         |

* プレイヤーはこの値を変更することで、非対称な関係（例：Aは好き、Bはそうでもない）を自由に設定可能。
* 初期設定後も、**管理室から好感度の再設定が可能**（ただし通常のプレイでは自然変化に任せることが推奨される）。

#### 3.3.3 自然減少ルール（毎日評価）

好感度は、キャラクター同士の接触頻度に応じて**自動的に減少**することがある。これは、長期間にわたり接触がない場合、関係性が希薄化することを表現している。

| 最終接触からの経過日数 | 減少量 |
| ----------- | --- |
| 3日以内に接触あり   | 0   |
| 4〜7日以内      | -1  |
| 8日以上        | -2  |

* \*\*「接触あり」\*\*とは、イベント（雑談・二人きり・思い出し など）で会話や交流が発生したことを指す。
* 評価は一日一回、自動的に処理される。

---

#### 3.3.4 イベントによる変化

好感度はイベント発生により**固定値で増減**する。各イベントには、相手への好感度変化量があらかじめ定義されている。

* 例：

  * 雑談イベント発生：+1〜+3
  * トラブルイベント：-3
* 数値は基本的に小さな変化の積み重ねを想定し、単一イベントで極端な変化が起きることは避ける。

---

#### 3.3.5 好感度の利用先

好感度そのものはUI上で直接表示されるが、数値の大小は以下のように他要素に影響する：

| 用途              | 影響内容                          |
| --------------- | ----------------------------- |
| 感情ラベルの抽選確率      | 高いほど好意的なラベルへの変化確率が上昇          |
| 関係ラベル変化イベントの発生率 | 高いほど発生しやすくなる（特に「友達」→「親友」「恋人」） |
| 特定イベントの台詞や反応    | キャラの反応がより柔らかく／鋭くなることがある       |

---

#### 3.3.6 UIでの表示

* **キャラステータス画面**にて、対象キャラに対する好感度が**バー形式で可視化**される。
* 数値は表示されないが、色の変化や長さによっておおよその傾向が分かるようになっている。
* 好感度の相互関係（A→BとB→A）は**非対称**であり、それぞれ独立して管理される。

---

### 3.4 感情ラベル仕様

#### 3.4.1 ラベルの種類と遷移構造

キャラクターA→Bに対して、以下のいずれか1種類の感情ラベルが付与される。
ラベルは\*\*片方向性（A→Bのみ）\*\*で、B→Aとは無関係である。

##### 通常関係（関係ラベルが「友達」など）

```
嫌いかも ← なし → 気になる → 好きかも
```

* 「気になる」は**接触がない期間が続くと自然にリセットされる**。
* 「好きかも」「嫌いかも」は自然には戻らず、**イベントによってのみ変化**する。

##### 特別関係（関係ラベルが「恋人」「親友」「家族」）

```
嫌い ← 普通 ← 好き（初期値）→ 大好き
```

* 初期状態は「好き」。
* 「大好き」状態からは、特定のイベントでのみ「嫌い」や「普通」に変化。
* 「大嫌い」状態に遷移した場合、**「別れたい」などの解除イベント**が発生する。

##### 特殊ラベル「気まずい」

* あらゆる関係・感情ラベルから遷移可能。
* **時間経過により自然にリセット**される。
* 特定のイベントを通じて、他の感情ラベルへと戻る場合もある。

#### 3.4.2 感情ラベルの変化タイミング

* 感情ラベルは以下のいずれかによって変化する：

  * **非関与イベント時の抽選**
  * **プレイヤー介入型イベント**
  * **時間経過（自然リセット）**

#### 3.4.3 感情ラベルのログ出力

感情ラベルが変化した際は、**キャラクター同士の会話ログとは別に**、以下の形式でシステム出力される：

```
SYSTEM: キャラA→キャラBの印象が「気になる」に変化しました。
```

※「ラベル」という語は使用せず、「印象」に言い換えて自然な文体とする。

#### 3.4.4 感情ラベルの変化抽選仕様

キャラクター間での感情ラベルは、イベントの発生時に一定確率で変化する。感情ラベルの変化には、主に以下の要素が影響する：

* イベントの種類（例：雑談イベント、思い出し会話イベント）
* 対象キャラクター同士の関係ラベル（本表では「友達」の場合を例示）
* 現在の感情ラベルと、そこから変化し得るラベルの組み合わせ
* 好感度の値（−100～+100）のうち、ここでは代表的に20・50・80を想定

以下に、具体的な変化確率の一覧を示す（数値は確定値として採用）：

##### 【雑談イベント】における変化抽選（関係ラベル：友達）

| 現在の感情ラベル | 変化先ラベル | 好感度=20 | 好感度=50 | 好感度=80 |
| -------- | ------ | ------ | ------ | ------ |
| なし       | 気になる   | 5%     | 10%    | 20%    |
|          | 嫌いかも   | 5%     | 3%     | 0%     |
|          | 気まずい   | 5%     | 3%     | 0%     |
| 気になる     | 好きかも   | 0%     | 3%     | 5%     |
|          | なし     | 5%     | 3%     | 0%     |

* 「変化先ラベル」が複数ある場合、それぞれが独立に抽選される（複数同時当選は起こらない。発生優先度は仕様外）。
* 「なし → 気になる」や「気になる → 好きかも」は、好感度が高いほど起こりやすい。
* 「嫌いかも」「気まずい」「なし（戻る）」は、主に好感度が低い場合に起こりやすい。
* 変化の有無はイベントごとに抽選され、**全体として変化が起きる確率は約30%前後**になるように調整される。

##### 備考

* 他イベント種（例：思い出し会話、二人きりの時間など）や他関係ラベルについても今後同様のテーブルで定義予定。

---

### 3.5 信頼度仕様

#### 3.5.1 概要

信頼度は、キャラクターがプレイヤーに対して抱く信頼の度合いを数値で表したパラメータであり、\*\*一方向の値（キャラ→プレイヤー）\*\*として扱う。キャラクター同士の関係性とは無関係に、プレイヤーとの個別のつながりを表すため、感情ラベルや好感度とは別に管理される。

信頼度は、主に\*\*プレイヤー介入イベント（困りごと相談）\*\*におけるプレイヤーの対応内容によって上下する。

#### 3.5.2 数値仕様

* **範囲**：`0 ～ 100`
* **初期値**：キャラクターごとに異なり、以下のような**性格パラメータに応じて設定されるランダム値**となる：

| 特性の例           | 初期信頼度の傾向値 |
| -------------- | --------- |
| 警戒心が強い（内向的／頑固） | 30〜40     |
| 社交的 or 行動力が高い  | 60〜70     |
| 通常（平均的）        | 50（中央値）   |

このように、初期信頼度は一律ではなく、キャラクターの性格に基づいた**幅を持たせた設定**となる。これにより、ゲーム開始時点からキャラクターごとの個性や距離感の差異が生まれるように設計されている。

#### 3.5.3 変化の契機

信頼度の変化は、原則として**プレイヤー介入イベント**で発生する。具体的には以下のようなケースがある：

| 契機                   | 変化方向 | 変化量の目安 |
| -------------------- | ---- | ------ |
| プレイヤーの適切な対応（相談への好回答） | 上昇   | +3〜+5  |
| プレイヤーの曖昧・回避的な回答      | 上昇   | +0〜+2  |
| プレイヤーの冷淡・否定的な対応      | 下降   | -2〜-4  |

なお、キャラクターの性格（例：気配り度が高い、表現力が高い など）により変化量が補正される場合がある。

#### 3.5.4 表示と通知

信頼度の変化は、イベント終了時に**ログ上で簡易に通知**される：

```
SYSTEM: 〇〇の信頼度が上昇しました。
```

この際、具体的な数値（+3など）は即座には表示されず、プレイヤーが後からステータス画面で確認できるようにする。

#### 3.5.5 信頼度による影響（予定）

現時点では信頼度による直接的な効果は限定的であるが、将来的に以下のような影響をもたらす仕様が設計される予定である：

* 信頼度が高いキャラクターは、プレイヤーに対してより頻繁に相談イベントを発生させる
* 信頼度が一定値以上になることで、特定のプレイヤー向け台詞や反応が解禁される
* 信頼度が極端に低下した場合、相談イベントがしばらく発生しなくなる　など

---

### 3.6 ステータス画面構成

#### 3.6.1 概要

ステータス画面は、各キャラクターの情報をプレイヤーが個別に確認するためのUIであり、「性格」「関係性」「信頼度」など、複数の要素をまとめて表示する場として機能する。情報は主に以下の3カテゴリに分けて提示される：

* プレイヤーとの関係
* 他キャラクターとの関係
* キャラクターの性格・傾向

本画面は主に情報確認を目的としており、編集機能は原則持たない。

#### 3.6.2 表示内容

##### ■ 基本情報セクション

* **キャラクター名**
* **性格傾向**

  * MBTI（推定タイプ）
  * スライダー形式による性格5項目（社交性／気配り傾向／頑固さ／行動力／表現力）

##### ■ プレイヤーとの関係情報

* **信頼度**（バー表示、デフォルトでは数値非表示）

※ キャラ→プレイヤー間には感情ラベルは存在しない。

##### ■ 他キャラとの関係一覧

* 一覧形式で全キャラクターとの関係ラベルを表示

  * 例：「〇〇：友達」「××：恋人」
* 各関係ラベルはクリックで詳細ポップアップ／遷移可能

##### ■ 好感度・感情ラベル（キャラ⇄他キャラ）

* **好感度**：他キャラクターごとにバー表示（片方向ずつ）
* **感情ラベル**：一人につき一件（キャラA→キャラB）、好感度に加えて印象の傾向を補足する要素
* 感情ラベルの表示は好感度バーの補足情報として併記される（例：バーの横に「好きかも」など）

※ 数値は画面上では表示せず、ビジュアルのみで相対的に確認可能

##### ■ 簡易イベント履歴（抜粋）

* 直近数件のイベントログを簡略表示（例：「〇〇と雑談した」など）
* 詳細は日報画面と連携して閲覧可能

#### 3.6.3 UI構成と操作

* セクションごとにタブまたは展開形式で構成
* 他キャラとの関係一覧は折りたたみ可能
* 信頼度・好感度のバーはマウスオーバーなどで数値を任意確認できる設計も検討余地あり

#### 3.6.4 備考・補足

* 感情ラベルに絵文字や色分けなどの視覚的装飾は行わない
* 関係ラベルは一人のキャラが複数所持することはない（「家族」も併存不可）
* 初期関係の設定結果もここに反映され、一覧上で確認可能

---

## 4.イベント仕様

### 4.1 イベントの基本構造

#### 4.1.1 イベントの分類

本作におけるイベントは、大きく以下の2種類に分類される：

| 分類        | プレイヤーの関与 | 主な役割            | 例                      |
| --------- | -------- | --------------- | ---------------------- |
| 非関与型（観察型） | なし       | キャラクター間の関係進展の観察 | 雑談イベント、思い出し会話、初対面、挨拶など |
| 関与型       | あり       | プレイヤーの選択で結果が分岐  | 困りごと相談（プレイヤー介入イベント）    |

> 補足：「関係ラベル」の変化を引き起こすイベントは主に観察型イベントだが、「恋人」への関係変化はプレイヤーの関与が必要となる。

#### 4.1.2 イベントの基本構成要素

すべてのイベントは、以下の基本構造を持つ：

1. **導入部**

   * イベントの趣旨が簡潔に説明される。例：「〇〇と××が会話中…」
2. **本体（会話・行動の描写）**

   * GPTにより生成されたキャラクター同士の自然な会話
   * 性格・関係性・時間帯などに基づいて内容が変化
3. **変化の適用（オプション）**

   * イベントの種類・内容に応じて、好感度・信頼度・関係ラベル・感情ラベルが変化する
4. **ログ出力**

   * プレイヤーに対し、発生イベントの概要と変化内容を提示（詳細は 4.4 を参照）

#### 4.1.3 イベント発生後の影響

イベントによっては、以下のような効果を伴う：

* **好感度の変化**

  * 多くのイベントで基本的に好感度は上昇
* **感情ラベルの抽選**

  * イベント内容と好感度に応じ、感情ラベルが変化する可能性がある（変化確率は約30%）
* **関係ラベルの変化**

  * 指定のイベントを通じて段階的に変化（例：「認知→友達」など）
* **信頼度の変化**

  * プレイヤー介入イベントのみで変動する（±固定値、数値は非表示）

なお、変化が起こった場合はすべて `SYSTEM:` ログに記載される。

---

### 4.2 イベントの発生タイミングと条件

#### 4.2.1 ゲーム内時間と時間帯の扱い

本作では、ゲーム内時間は現実時間と同期して進行する仕様である。
プレイヤーがアプリを開いた時点の「時間帯」によって、発生するイベントの種類や内容に偏りが出る。

##### 時間帯分類（暫定）

| 分類名 | 対応する現実時間（例） | 備考            |
| --- | ----------- | ------------- |
| 朝   | 6:00〜10:59  | 登校・通勤前の時間帯    |
| 昼   | 11:00〜15:59 | 学校・仕事中の時間帯    |
| 夕方  | 16:00〜18:59 | 放課後・帰宅時間帯     |
| 夜   | 19:00〜23:59 | 自由時間・交流が活発になる |
| 深夜  | 0:00〜5:59   | 活動量が少ない       |

※ 実際の分類基準や発生率の調整は今後検討される可能性がある。

#### 4.2.2 キャラクター状態による制限

イベントは、キャラクターの状態によって発生可否が制限される。以下は主な条件の一例：

| 状態  | 発生可能なイベントの例        | 備考           |
| --- | ------------------ | ------------ |
| 通常  | 全てのイベントが発生対象       |              |
| 就寝中 | 非発生状態              | すべてのイベントが対象外 |
| 風邪  | 雑談・挨拶など一部軽度なイベントのみ | イベント頻度も減少傾向  |

キャラごとの活動傾向（夜型・朝型など）に応じて、特定時間帯に起こりやすいイベントを設定することも可能である。

#### 4.2.3 キャラクター性格による発生確率の傾斜

キャラクターの性格により、イベント種別ごとの発生しやすさが変化する。

| 性格要素   | 発生しやすいイベント             |
| ------ | ---------------------- |
| 社交性が高い | 雑談イベント、初対面イベント         |
| 社交性が低い | 思い出し会話イベント、二人きりの時間イベント |
| 行動力が高い | イベントの発端側（自分から話しかける等）   |
| 気配りが高い | プレイヤーへの相談イベント          |

※ 本発生傾斜は確率的なものであり、必ずしも性格と一致するとは限らない。

#### 4.2.4 イベント進行とプレイヤーの不在

イベントは、プレイヤーがアプリを開いていない間にも内部的に進行する。
ただし、非関与型イベントの発生ログはプレイヤーがアプリを開いた時点でまとめて表示される（例：「〇〇と××が会話中…」）。

プレイヤーがログインした時間帯に応じて、最も適切なイベントが抽選されて表示される設計となっている。

---

### 4.3 イベントの種類一覧と概要

本作では、イベントはその性質や役割に応じて複数のカテゴリに分類される。以下に主要なイベント種別と、それぞれの概要を示す。

#### 4.3.1 雑談イベント

* **分類**：非関与型（観察型）
* **発生条件**：

  * 関係ラベルが「友達」「親友」「恋人」「家族」のいずれかである
  * 通常状態で活動中のキャラクター同士
* **内容**：

  * その場の話題や季節、時間帯に応じた雑談を展開
  * 会話後に好感度の上昇、および感情ラベルの抽選が行われることがある

#### 4.3.2 思い出し会話イベント

* **分類**：非関与型（観察型）
* **発生条件**：

  * 関係ラベルが「友達」「親友」「恋人」「家族」のいずれか
* **内容**：

  * 過去の出来事や以前の会話を思い出して再び話題にするイベント
  * キャラクター同士の関係が深いときに発生しやすく、好感度上昇の余地が大きい

#### 4.3.3 二人きりの時間イベント

* **分類**：非関与型（観察型）
* **発生条件**：

  * 状況的に二人きりになれる場面（他キャラクターが不在など）
  * 関係ラベルや感情ラベルに関係なく発生可能
* **内容**：

  * 通常より親密な雰囲気での会話が展開される
  * 感情ラベル変化の抽選確率がやや高く設定されている

#### 4.3.4 挨拶イベント

* **分類**：非関与型（観察型）
* **発生条件**：

  * 関係ラベルにかかわらず発生可能
  * 比較的接触頻度が少ないキャラクター同士に発生しやすい
* **内容**：

  * 挨拶を交わす短い会話イベント
  * 初対面を演出する場合もあり、関係ラベル「なし」→「認知」への移行契機にもなる

#### 4.3.5 プレイヤー介入イベント（困りごと相談）

* **分類**：関与型（選択式 or 穴埋め式）
* **発生条件**：

  * キャラクターの内部状態に応じて随時生成
  * 信頼度が一定以上あるキャラクターに優先発生
* **内容**：

  * キャラクターがプレイヤーに助言や相談を求めてくる
  * プレイヤーの対応により信頼度が増減する
  * イベント終了時にはキャラクターが短くリアクションを返す（例：「ありがとう」など）

#### 4.3.6 備考

* 以下のイベントは現在未実装であり、将来的に追加予定：

  * 「認知」→「友達」：友達になるイベント（非関与型）
  * 「友達」→「親友」：親友になるイベント（非関与型）
  * 「友達」→「恋人」：告白イベント（プレイヤー介入型）
  * 「親友」or「恋人」→「友達」：別れイベント（介入型予定）

---

### 4.4 ログ出力ルールと形式

本作では、発生したイベントに関する情報がリアルタイムで画面内にログ表示される。ログの主な目的は、**キャラクター間の出来事を観察しやすくする**こと、および**関係変化や感情の変動を視覚的に確認可能にする**ことである。

#### 4.4.1 ログの構成

ログは以下の要素で構成される：

| 種別     | 表記例                               | 備考                        |
| ------ | --------------------------------- | ------------------------- |
| イベント発生 | `EVENT: ◯◯と△△が会話中…`               | 会話や行動イベントの導入部分。発生時点で1行出力。 |
| システム通知 | `SYSTEM: ◯◯→△△の印象が「好きかも」に変化しました。` | 感情ラベルや関係ラベル、好感度・信頼度の変化等。  |
| 空行     |                                   | イベントの切れ目に1行空けて視認性を確保する。   |

#### 4.4.2 出力ルールの詳細

##### （1）イベントログ（EVENT）

* 会話・行動イベントが発生した時に、冒頭に1行だけ表示される。
* 表記は「◯◯と△△が○○中…」「◯◯がプレイヤーに相談しています…」などの定型。
* 会話の内容そのものはログには表示されない（非公開）。

##### （2）システムログ（SYSTEM）

* イベント終了時点で変化があった場合にのみ表示される。
* 以下のような形式で記載：

```text
SYSTEM: ◯◯→△△の印象が「好きかも」に変化しました。
SYSTEM: ◯◯→△△との関係が「親友」になりました。
SYSTEM: ◯◯からの信頼度が上昇しました。
```

* 好感度や信頼度の変化については、数値ではなく「上昇」「下降」と表記。
* 一つのイベント内で複数の変化があった場合は、ログ内に複数行表示。

##### （3）表示位置・アニメーション

* ログは画面下部（CLI風ログ表示エリア）に表示。
* 新しいログは下から上へ積み重なる形式で表示。
* ログの更新はアニメーションで表示され、内容の自然な流れを演出。

#### 4.4.3 特記事項

* ログはゲーム内でのプレイヤーに対する主要なフィードバック手段であり、**キャラクターの独白や内心は表示されない**。
* プレイヤー介入イベントでは、**プレイヤーの選択内容そのものはログには残らず**、あくまでその結果のみが表示される。
* イベント履歴の保存に関しては別途日報画面にて確認可能。

---

## 5.内部処理・抽選仕様

### 5.1 イベント発生抽選

この節では、キャラクター間で自動的に発生する非介入型イベント（雑談・挨拶・思い出し・二人きり等）の抽選処理について記述する。

#### 5.1.1 候補ペアの生成ルール

非介入型イベントは、対象となる**キャラクターのペア**をあらかじめ生成し、その上でイベント種別を選定し、最終的に抽選・実行される。

##### 対象ペアの生成条件：

* **共通条件（全イベント種別共通）**

  * 両者ともに状態が「就寝中」「風邪」等の制限状態でないこと
  * 両者ともに**初期設定済みであり、削除フラグが立っていないこと**

* **種別ごとの補正条件**

  * 「雑談イベント」：関係ラベルが「友達」「親友」「恋人」「家族」
  * 「挨拶イベント」：関係ラベルが「なし」「認知」「友達」「親友」「恋人」「家族」
  * 「思い出し会話イベント」：関係ラベルが「友達」「親友」「恋人」「家族」
  * 「二人きりの時間イベント」：関係ラベル・感情ラベルに関係なく抽選可能

##### ペアの生成方法（例）：

全キャラクターの中から、条件を満たす順序付きペア（A→B）を列挙。
ペア数が多すぎる場合は、一定数（例：上限20ペア）までに絞り込み。

#### 5.1.2 イベント種別の選定ロジック

対象ペアごとに発生可能なイベント種別を抽出し、その中から一つを選定する。

##### 優先度設定（例）：

下記のような優先度を持ち、上位から順に候補を評価：

| イベント種別 | 優先度 | 備考                     |
| ------ | --- | ---------------------- |
| 思い出し会話 | 高   | 関係ラベルが適している場合は優先的に選ばれる |
| 雑談     | 中   | ランダム性ありつつ頻出            |
| 挨拶     | 中   | 接触の起点となるイベント           |
| 二人きり   | 低   | 条件を満たすペアが少ない           |

※ただし、優先度は「発生率」ではなく「候補として選ばれる順序」を意味する。

#### 5.1.3 発生確率の調整要因

最終的なイベント抽選において、以下の要素が発生確率に影響する：

* キャラ同士の関係ラベル（親しさが高いほど会話イベントが発生しやすい）
* 好感度（片方向が極端に低いと発生率が下がる）
* 性格パラメータ（外交性が高いキャラほど話しかけ役になりやすい）
* 感情ラベルの状態（「嫌いかも」などを持っていると抽選対象外になることがある）
* 時間帯（朝や夜間など、非活動時間帯では制限を設ける可能性あり）

#### 5.1.4 その他制限・発生抑制条件

以下のような状況では、イベント発生が**抑制または禁止**される：

* 同一のキャラが前回イベントから一定時間が経過していない（イベント連続抑制）
* 同一のペアで直前にイベントが発生していた
* 他の重要イベント（プレイヤー介入イベントなど）が画面上で処理中

---

### 5.2 プレイヤー介入イベント（困りごと）の生成

この節では、画面内に一時的に表示される「困りごと」相談イベントの生成および管理に関する内部処理仕様を記述する。これらはプレイヤーが選択または入力で対応することで完了し、信頼度などの変化を引き起こす。

#### 5.2.1 イベント生成タイミングと頻度

##### 自動生成のタイミング：

* ゲーム内時間と同期し、**約1時間ごと**に生成処理を試行
* 画面に既に表示されている相談が**存在しない場合**に限り、新規生成される
* 生成処理は1回につき**1件のみ**

##### 同時発生の制限：

* 複数の相談が**同時に画面上に表示されることはない**
* 既存のイベントがプレイヤーに無視されている間は、次の生成は行われない

#### 5.2.2 対象キャラクターの選定条件

困りごとの発信者となるキャラクターは、以下の条件をすべて満たす必要がある。

##### 必須条件：

* 状態が「就寝中」「風邪」などでない
* **信頼度が一定以上**（具体的には+10以上など）である
* 直近1時間以内に他の困りごとイベントを発生させていない
* 現在ログ上に「信頼度が下がる」イベント等が連続して発生していない

##### 補正条件：

* **信頼度が高いほど発生確率が上昇**
* 外交性・表現力が高いキャラクターは選ばれやすい傾向

#### 5.2.3 内容の選択と形式

困りごとは、以下の2形式のいずれかに分類される：

| 種別   | 内容形式        | プレイヤー操作    |
| ---- | ----------- | ---------- |
| 選択式  | 2～3択のうちから選ぶ | ボタンで回答     |
| 穴埋め式 | 一部が空欄の文章    | キーボード入力で補完 |

##### 相談内容の例：

* 「〇〇ってどう思う？最近ちょっと気になってて…」
* 「この前のこと、〇〇に伝えた方がいいと思う？」

##### 内容の多様性：

* 一定数のテンプレートからランダム選出（個性や関係性で出現制御）
* 過去に同一の相談が表示されたキャラクターには**別の内容を優先的に表示**

#### 5.2.4 回答後の処理と自動消滅

##### プレイヤーが回答した場合：

* 該当キャラが「ありがとう！」などの返答を行い、信頼度変動（上昇 or 停止）を伴って終了
* 回答内容によって信頼度が変化するが、数値は**その場では表示されない**
* ログに「SYSTEM: 〇〇からの信頼度が上昇しました。」等を出力

##### プレイヤーが無視した場合：

* 表示から**約1時間経過後に自動消滅**
* 特別なログ出力は行われない

---

このように、プレイヤー介入イベントは**リアルタイム性と選択一回性を重視**した構成とし、UI上でも自然に表示・終了するように設計されている。

---

### 5.3 感情ラベルの抽選

本節では、キャラクター間のイベント終了時に発生する「感情ラベル」の変化について、その抽選ロジックと実装方針を示す。

#### 5.3.1 概要

キャラクター間の感情ラベルは、イベント発生時の印象や好感度に応じて、一定確率で変化する可能性がある。
変化は必ずしも発生するわけではなく、**排他的抽選（1つのみ当選）**によって実施される。

抽選は、対象イベントの終了直後に実行され、該当する場合のみログに明記される。

#### 5.3.2 抽選対象となるイベント種別

以下のイベント種別が、感情ラベル変化抽選の対象である。

- 雑談イベント
- 二人きりの時間イベント
- 思い出し会話イベント
- 挨拶イベント（※ただし変化率はかなり低く設定）

プレイヤー介入イベント（困り事相談など）では、感情ラベルの変化は発生しない。

#### 5.3.3 抽選処理の流れ（標準処理）

1. **抽選対象の確認**  
   該当イベント種別であるかを確認し、対象であれば抽選を実施。

2. **雰囲気（仮称）の決定**  
   イベント発生時に抽選された「会話の雰囲気（とてもポジティブ〜とてもネガティブの5段階）」により、感情変化テーブルを選定。

3. **感情ラベル変化の抽選**  
   好感度・関係ラベルに応じた変化候補とその確率を取得し、1～100の整数からランダムで1つを選出。
   その値がどの範囲に入るかで変化内容を決定する。

   （例）  
   - 雰囲気：普通  
   - 関係ラベル：友達  
   - 好感度：+20  
   - 感情ラベル：なし  

   → 抽選テーブル（仮）：
     - 気になる：5%
     - 嫌いかも：5%
     - 気まずい：5%
     - 変化なし：85%

   ランダムで「4」が出た場合、「気になる」に変化。

4. **ログ出力**  
   変化があった場合のみ、ログに以下のような記載を行う：

   ```
   SYSTEM: A→Bの印象が「気になる」に変化しました。
   ```

#### 5.3.4 雰囲気による補正（導入予定）

イベントには「雰囲気（仮称）」パラメータを導入予定である。
これはGPTプロンプトに反映されるだけでなく、抽選にも直接影響を与える。

雰囲気は、イベント発生時にイベント種別・関係ラベル・好感度などを元に抽選され、以後そのイベント中は固定される。
雰囲気ごとに抽選テーブルが異なるため、同じ好感度でも変化率が上下する仕組みとなる。

この仕様により、会話と結果の整合性がより高まり、プレイヤーの納得感や演出の説得力を担保できるよう設計している。

※詳細仕様は「5.3.4 感情ラベル抽選における雰囲気パラメータの導入（構想）」にて別途記載。

#### 5.3.5 補足事項

- 感情ラベルの変化はキャラA→Bの片方向のみ処理される。
- 関係ラベルが「恋人」「親友」などでも感情ラベルの変化は発生しうる。
- すでに特定の感情ラベルを持っている場合でも、他ラベルに上書き変化することがある。
- 「気になる」「気まずい」は時間経過で自然にリセットされる特殊な感情ラベルであるが、イベントにより他ラベルへ変化することもある。

---

### 5.4 関係ラベルの変化

本節では、キャラクター間における「関係ラベル」の変化処理について記述する。関係ラベルはキャラA⇄Bの**双方向同値関係**であり、イベントを通じて段階的に変化する。

#### 5.4.1 概要

関係ラベルは、以下のような段階を持つ：

- なし
- 認知
- 友達
- 親友
- 恋人（※プレイヤー介入イベントでのみ到達可能）
- 家族（※初期設定時にのみ指定可能、他ラベルと併存不可）

多くの関係ラベルの変化は、**プレイヤーの介入を必要としないイベント（非介入イベント／観察イベント）**を通じて発生する。
時間経過によって変化するのは「なし」→「認知」のみであり、それ以外の関係ラベルは、主にイベントによって変化する。
なお、プレイヤーの介入を必要とするイベントを通じて変化するのは、「友達」→「恋人」（および将来的に予定されている「恋人」→〇〇）など、一部のケースに限られる。

#### 5.4.2 初期関係の設定

新規キャラクター追加時、あるいは後から「管理室」より、初期関係を手動で設定できる。
「友達」「家族」「恋人」などのラベルを、すでに存在する他キャラに対して事前に付与しておくことができる。

なお、初期関係として「家族」を選択した場合は、他の関係ラベルと**併存できない**（排他的に扱われる）。

また、関係ラベルに応じて好感度の**初期値が自動的に変化**する仕様を採用しており、設定された関係に応じて+20～+70程度の好感度が初期値として与えられる。

#### 5.4.3 関係ラベルの変化イベントと条件

| 現在の関係ラベル | イベント種別             | イベント分類 | プレイヤー介入 | 新しい関係ラベル |
|------------------|--------------------------|----------------|----------------|------------------|
| なし             | 挨拶イベント              | 観察型         | 不要           | 認知             |
| 認知             | 友達になるイベント（仮称）| 観察型         | 不要           | 友達             |
| 友達             | 親友になるイベント（仮称）| 観察型         | 不要           | 親友             |
| 友達             | 告白イベント              | 介入型         | 必要           | 恋人             |
| （任意）         | 別れイベント（仮称）      | 介入型         | 必要           | 友達など         |

「家族」への変化イベントは存在せず、手動設定のみによる。

#### 5.4.4 ラベル変化の記録と表示

関係ラベルの変化が発生した場合、ログ上に以下のような形で記録される：

```
SYSTEM: AとBの関係が「友達」になりました。
```

また、ステータス画面やキャラ関係詳細画面にて、最新の関係ラベルを確認可能。

#### 5.4.5 注意点

- 関係ラベルは双方向で共通（A⇄B）である。
- 一部ラベル（家族）は排他的で、他のラベルと併存できない。
- 一度「恋人」や「親友」になった場合でも、特定のイベントにより解除される可能性がある（例：別れイベント）。

---

### 5.5 ラベル変化の記録と表示

本節では、関係ラベルおよび感情ラベルが変化した際のログ記録形式と、画面上での表示仕様について記述する。


#### 5.5.1 ログ出力の基本形式

ラベル変化が発生した場合、メイン画面に表示されるログには以下のような形式で記録される。

##### 関係ラベル変化時
```
SYSTEM: AとBの関係が「友達」になりました。
```

##### 感情ラベル変化時
```
SYSTEM: A→Bの印象が「気になる」に変化しました。
```

感情ラベルに関しては、双方向ではなく、片方向的な変化を示す表現を用いる。

#### 5.5.2 出力タイミング

ラベル変化が発生したイベントの直後、その他のログ出力と合わせて即時に表示される。  
イベントのログよりも下位に位置し、後続の会話ログが続く場合はその直後に差し込まれる。

#### 5.5.3 出力対象の制御

以下の場合、ログは出力されない：

- 関係ラベル・感情ラベルに**変化がなかった**場合
- ラベルが「なし」にリセットされたが、**同一状態への遷移**である場合（例：既に「なし」で、リセット処理が行われたなど）

#### 5.5.4 ラベルの表示位置（画面UI）

関係ラベル・感情ラベルの現在の状態は、以下の場所にて確認できる：

- **ステータス画面**（キャラ→他キャラとの関係一覧に表示）
- **キャラ関係詳細画面**（一対一の関係と変遷履歴）
- **管理室**（設定用の編集画面）

なお、ログ上では過去の変化履歴も一定期間保持され、ユーザーが任意に参照可能となる。

#### 5.5.5 備考

- 表示文言に「ラベル」等の技術的表現は使用しない。
- 感情ラベル「気まずい」など、一時的な印象変化も記録対象とする。
- 表示に使用する文字列は統一し、システムメッセージとしてログ上に出力する。

---

### 5.6 その他の変化仕様

本節では、ラベルや信頼度・好感度以外で、時間経過やイベントによって変化する要素について簡潔に記述する。

#### 5.6.1 状態変化（例：「風邪」「就寝中」）

各キャラクターには一時的な「状態」が付与されることがあり、主に以下のような状態が存在する：

- **風邪**：体調が悪くなる。発言頻度や内容に変化が出る場合がある。
- **就寝中**：深夜帯などに自動的に付与。イベント発生の抑制などに影響。

これらの状態は「みんなの様子」画面にて、キャラ名の横にテキストで表示される。

#### 5.6.2 状態の付与と解除

- 状態は、**時間帯**や**イベントトリガー**により自動的に付与・解除される。
- 「風邪」状態は一定確率で発症し、数日間持続する。
- 「就寝中」はプレイヤーの端末時間に基づき、深夜0時～朝6時に自動的に付与される。
- その他の状態も、今後の拡張で追加予定。

#### 5.6.3 UI上での反映

状態は以下の画面で視認可能：

- **みんなの様子（キャラ一覧）**
- **キャラステータス画面（補足情報エリア）**

状態の詳細な説明は基本的にUI上に表示されず、直感的な理解を重視する。

#### 5.6.4 備考

- 状態変化はログとしては記録されない。
- 状態が原因でイベントが発生しなかった場合も、特に通知や記録は行われない。

---

## 6.データ構造と保存仕様

本章では、アプリケーションにおける各種データの構造と、それらの保存および読み込みに関する仕様を記述する。UI設計や内部処理仕様と連動し、キャラクター、関係、イベント履歴等をどのように保持・管理・永続化するかを明確にすることを目的とする。

### 6.1 データ構造の全体概要

本アプリケーションでは、以下の主要な構成単位ごとにデータを管理する：

- キャラクター（Character）
- 関係（Relationship）
- 感情ラベル（EmotionLabel）
- 状態（Status）
- イベント履歴（EventHistory）
- 日報（DailyReport）
- プレイヤー情報（PlayerData）

それぞれの構造や保存形式については以降の節にて詳述する。

---

### 6.2 キャラクターデータの構造

本節では、各キャラクターが持つ情報およびその構造について定義する。キャラクターごとのデータは、基本情報、性格パラメータ、関係情報、状態情報など多岐にわたる。これらは保存形式としてJSONまたはオブジェクト指向言語でのクラス構造を想定しており、以下のような項目を持つ。

#### 6.2.1 基本情報

| 項目名       | 型     | 説明 |
|------------|--------|------|
| id         | string | 一意のキャラクターID |
| name       | string | 表示名（ニックネーム） |
| mbti       | string | MBTIタイプ（省略可）|
| mbti推定用回答 | array  | MBTI診断スライダー値（5段階×各軸） |
| 性格パラメータ | object | 各5段階スライダー形式の性格値（社交性・気配り傾向・頑固さ・行動力・表現力） |

※MBTIタイプは、ユーザーが直接指定することも、診断スライダーによって推定することも可能である。

#### 6.2.2 関係情報（他キャラクターとの関係）

| 項目名 | 型 | 説明 |
|--------|----|------|
| relationships | object | 各キャラクターとの関係ラベル（共通）と好感度（片方向） |

```json
relationships: {
  "キャラBのID": {
    "relation_label": "友達",
    "affection": 35,
    "emotion_label": "気になる"
  }
}
```

#### 6.2.3 状態・変化情報

| 項目名 | 型 | 説明 |
|--------|----|------|
| status         | string | 現在の状態（就寝中・風邪など） |
| last_interacted | string (ISO date) | 最終接触日（好感度減衰判定に使用） |

#### 6.2.4 プレイヤーとの関係

| 項目名 | 型 | 説明 |
|--------|----|------|
| trust        | number | プレイヤーに対する信頼度（-100〜100） |
| last_support | string (ISO date) | 最終介入イベント時刻 |

キャラクターデータは個別ファイルとして保存されるか、アプリケーション全体のマスターデータに統合されて管理される。

---

### 6.3 関係・感情データの構造

本節では、キャラクター間の関係ラベル、感情ラベル、好感度、プレイヤーとの信頼度など、人間関係に関連するデータ構造について記述する。

#### 6.3.1 関係ラベル（relation_label）

- A↔B の双方向で1つのみ存在し、排他的なラベルである。
- 以下のような状態が存在する：

| ラベル名 | 変化方法 | 備考 |
|----------|----------|------|
| なし     | 初期状態 |  |
| 認知     | 自動（挨拶イベント or 時間経過）|  |
| 友達     | 非介入イベント（友達になるイベント）|  |
| 親友     | 非介入イベント（親友になるイベント）|  |
| 恋人     | プレイヤー介入イベント（告白イベント）|  |
| 家族     | 初期設定・管理室にて手動設定（併存不可）| 他ラベルと併存不可 |

```json
"relation_label": {
  "characterA_id": {
    "characterB_id": "友達"
  }
}
```

#### 6.3.2 感情ラベル（emotion_label）

- A→B の片方向で1つだけ持つ。
- 以下の系列が存在する：

##### 「認知」「友達」以下の関係で使用される感情ラベル：
- なし（初期状態）
- 気になる
- 好きかも
- 嫌いかも
- 気まずい（特別な状態で、全関係ラベルで共有）

##### 「親友」「恋人」「家族」の関係で使用される感情ラベル：
- 普通（初期状態）
- 好き
- 大好き
- 嫌い
- 大嫌い
- 気まずい

```json
"emotion_label": {
  "characterA_id": {
    "characterB_id": "気になる"
  }
}
```

#### 6.3.3 好感度（affection）

- A→B の片方向で管理。
- -100 〜 +100 の整数値で表現。
- 初期値は 0。ただし、初期関係の設定により値を変動させることが可能。

```json
"affection": {
  "characterA_id": {
    "characterB_id": 35
  }
}
```

#### 6.3.4 信頼度（trust）

- キャラクター → プレイヤー の片方向で管理。
- -100 〜 +100 の整数値で表現。
- 初期値は 0。

```json
"trust": {
  "character_id": 20
}
```

※感情ラベルと関係ラベルの変化は、イベントや時間経過を通じて別途管理される。

---

### 6.4 ログ・履歴の保存仕様

本節では、アプリ内で生成される各種イベントログ、状態変化ログ、及びそれらの保存形式について説明する。

#### 6.4.1 ログの種類

以下の種類のログが存在する：

| ログ種別 | 内容 | 表示場所 | 保存対象 |
|----------|------|----------|----------|
| イベントログ | キャラクター同士の会話やイベント発生 | メイン画面CLI風ログエリア | ログ履歴 |
| システムログ | 関係ラベル、感情ラベル、好感度等の変化通知 | メイン画面CLI風ログエリア | ログ履歴 |
| 介入イベント応答 | プレイヤーが選択した回答とその反応 | メイン画面CLI風ログエリア | ログ履歴 |
| 日報ログ | 各日終了時にまとめて出力されるイベント一覧 | 日報画面 | 日報履歴 |

#### 6.4.2 ログの保存形式

ログは日付ごとにまとめられ、以下のようなJSON形式で保存される：

```json
{
  "2025-07-01": [
    {
      "type": "event",
      "content": "EVENT: AとBが会話中…"
    },
    {
      "type": "system",
      "content": "SYSTEM: A→Bの印象が「気になる」に変化しました。"
    },
    {
      "type": "intervention",
      "content": "SYSTEM: Aからの相談に対して「こうすればいいんじゃない？」と回答"
    }
  ]
}
```

#### 6.4.3 保存場所・保存方針

- ログはブラウザローカルストレージまたはIndexedDBに保存される想定。
- エクスポート・インポート機能によって任意の外部保存・読み込みが可能。
- 日報は別途、日単位で履歴として記録される。

#### 6.4.4 日報の構造例

日報は以下のような簡潔な形式で記録される：

```json
{
  "date": "2025-07-01",
  "events": [
    "AとBが雑談した",
    "CとDが二人きりの時間を過ごした",
    "E→Fの印象が「気になる」に変化した"
  ]
}
```

#### 6.4.5 備考

- ログはユーザーの設定により非表示にすることも可能だが、内部的には常に保存されている。
- 感情ラベルや関係ラベルの変化ログは、システムログとして自動出力される。

---

### 6.5 セーブ・ロード仕様

本節では、ゲーム内の状態を保存・復元するためのセーブおよびロード機能の設計仕様を記述する。

#### 6.5.1 セーブ対象のデータ

セーブ機能では、以下のデータが保存対象となる：

- キャラクターデータ（プロフィール、性格、信頼度など）
- 関係・感情・好感度データ
- イベント履歴（ログ）
- 日報履歴
- プレイヤーによる設定（名前やUI設定など）
- キャラ一覧の状態（体調、就寝中など）

#### 6.5.2 セーブ形式

セーブデータは、JSONフォーマットで構造化される。全体は以下のような構成となる：

```json
{
  "save_id": "save1",
  "datetime": "2025-07-01T22:00:00",
  "player_settings": {...},
  "characters": {...},
  "relations": {...},
  "logs": {...},
  "reports": {...},
  "status": {...}
}
```

#### 6.5.3 ロード仕様

- ロード時には、保存時点の状態を完全に復元する。
- セーブデータ選択画面から任意のデータを選択可能。
- 復元後、画面上には「復元完了」の表示がされる。
- システム内部時間はロード時点では現在時刻と同期されるため、時間経過による差異が発生する。

#### 6.5.4 セーブスロット

- セーブスロットは最大で5つまで保持可能。
- オートセーブは1スロットに固定され、他4つはマニュアルセーブ用。
- セーブスロットは日時と簡易説明文（任意）で管理される。

#### 6.5.5 バックアップ機能

- 外部出力（ファイル形式）によるセーブデータのバックアップが可能。
- 形式：`.json`
- インポート時には現在のデータを上書きするか、別スロットに保存するかを選択可能。

#### 6.5.6 備考

- セーブ機能は基本的に内部ストレージ（ブラウザのローカルストレージやIndexedDB）を使用。
- 外部バックアップはユーザーの任意操作による。