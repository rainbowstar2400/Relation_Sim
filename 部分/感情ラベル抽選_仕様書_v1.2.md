
# 感情ラベル抽選仕様書 v1.2

本仕様は、非関与イベント発生時におけるキャラクター間の**感情ラベル変化の抽選処理**について定めるものです。  
感情ラベルの種類、変化の発生条件、抽選確率、および補間方法などを網羅的に記述します。

---

## 🎯 抽選の対象となるイベント種別

本仕様は以下の**非関与イベント（プレイヤー介入のないイベント）**に適用されます：

- `conversation`（雑談イベント）
- `memory_or_private`（思い出し会話／二人きりの時間イベント）

これらは抽選ロジック上で区別され、**異なる変化確率が設定されます**。

---

## 🔁 感情ラベルの基本遷移

感情ラベルは以下のような構造で変化します（イベント発生時にのみ）：

### 通常関係（関係ラベルが「友達」など）

```
嫌いかも ← なし → 気になる → 好きかも
```

- 「気になる」は自然にリセットされる（接触なしの場合）
- 「好きかも」「嫌いかも」は自然には戻らない（イベントが必要）

### 特別関係（関係ラベルが「恋人」「親友」「家族」）

```
嫌い ← 普通 ← 好き（初期値）→ 大好き
```

- 「大嫌い」は専用イベント発生時に変化し、「別れたい」イベントに移行可能

### 特殊：気まずい

- どの関係・どの感情からも移行可能
- 自然リセットあり／また、他の感情ラベルに戻るイベントも存在

---

## 🎲 抽選確率の設計

- 抽選確率は、以下4つのパラメータをキーとして定義されます：

```
(event_type, 関係ラベル, 現在の感情ラベル, 変化先ラベル)
```

- `event_type` は `"conversation"` または `"memory_or_private"`

### 例：

| event_type         | 関係ラベル | 現在の感情 | 変化先     | 好感度=20 | 好感度=50 | 好感度=80 |
|--------------------|------------|------------|-------------|------------|------------|------------|
| conversation        | 友達       | なし        | 気になる    | 10         | 20         | 35         |
| memory_or_private   | 友達       | なし        | 気になる    | 15         | 25         | 40         |

- 好感度は内部的に数値（0–100など）として管理され、実際の確率は補間して取得
- CSV等で定義される値が3点のみの場合も、**線形補間（ffill含む）**で中間値を自動算出

---

## 🔢 実装上の補足

- 変化しない（＝現状維持）の確率は、変化先以外すべてを引いた残り（例：70%程度）
- 感情ラベルは A→B, B→A の片方向ごとに独立して抽選
- 各イベント発生時、関連キャラペアすべてに抽選を実施
- プレイヤー関与イベントによる強制変化処理は本仕様の対象外

---

## ✅ 今後の対応

- プレイヤー関与型イベントによる感情変化（例：別れたい）は別途仕様書にて管理
- 抽選に使う好感度しきい値（例：20, 50, 80）は柔軟に設定・拡張可能
